# AGENTS.MD - Documentaci√≥n T√©cnica Completa de Factum AI

> **Prop√≥sito**: Este documento explica paso a paso c√≥mo funciona el proyecto Factum AI para que cualquier inteligencia artificial o desarrollador pueda entenderlo completamente.

---

## üìã Tabla de Contenidos

1. [Descripci√≥n General](#1-descripci√≥n-general)
2. [Arquitectura del Sistema](#2-arquitectura-del-sistema)
3. [Tecnolog√≠as Utilizadas](#3-tecnolog√≠as-utilizadas)
4. [Estructura de Carpetas](#4-estructura-de-carpetas)
5. [Frontend - Aplicaci√≥n React](#5-frontend---aplicaci√≥n-react)
6. [Backend - AWS Lambda](#6-backend---aws-lambda)
7. [Flujo de Datos Completo](#7-flujo-de-datos-completo)
8. [Sistema de Clasificaci√≥n de Contenido](#8-sistema-de-clasificaci√≥n-de-contenido)
9. [Servicios y Utilidades](#9-servicios-y-utilidades)
10. [Configuraci√≥n de Variables de Entorno](#10-configuraci√≥n-de-variables-de-entorno)
11. [Gu√≠a de Despliegue](#11-gu√≠a-de-despliegue)
12. [Soluci√≥n de Problemas](#12-soluci√≥n-de-problemas)

---

## 1. Descripci√≥n General

### ¬øQu√© es Factum AI?

**Factum AI** es una aplicaci√≥n web de moderaci√≥n de contenido que analiza im√°genes usando inteligencia artificial para detectar contenido inapropiado. Utiliza **Amazon Rekognition** como motor de an√°lisis.

### ¬øQu√© problema resuelve?

Permite a plataformas web y aplicaciones moderar autom√°ticamente im√°genes subidas por usuarios, clasific√°ndolas en tres niveles:

| Nivel | Color | Acci√≥n | Descripci√≥n |
|-------|-------|--------|-------------|
| **Seguro** | üü¢ Verde | Aprobaci√≥n autom√°tica | Contenido apropiado para publicar |
| **Sugestivo** | üü° Amarillo | Revisi√≥n manual | Contenido que requiere decisi√≥n humana |
| **Inseguro** | üî¥ Rojo | Bloqueo autom√°tico | Contenido expl√≠cito o violento |

### Caracter√≠sticas Principales

- ‚úÖ **Drag & Drop** para subir im√°genes
- ‚úÖ **An√°lisis con IA** usando Amazon Rekognition
- ‚úÖ **Clasificaci√≥n en 3 niveles** (safe/suggestive/unsafe)
- ‚úÖ **7 pantallas navegables** con dise√±o modular
- ‚úÖ **Historial persistente** en localStorage
- ‚úÖ **Configuraci√≥n personalizable** de umbrales

---

## 2. Arquitectura del Sistema

### Diagrama de Arquitectura

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                           USUARIO (Navegador Web)                        ‚îÇ
‚îÇ                                                                          ‚îÇ
‚îÇ   1. Arrastra imagen    2. Ve progreso    3. Recibe resultado           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                    ‚îÇ
                                    ‚îÇ HTTPS
                                    ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        FRONTEND (React + Vite)                           ‚îÇ
‚îÇ                                                                          ‚îÇ
‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                   ‚îÇ
‚îÇ   ‚îÇ   App.jsx   ‚îÇ   ‚îÇ  Screens/   ‚îÇ   ‚îÇ Components/ ‚îÇ                   ‚îÇ
‚îÇ   ‚îÇ Orquestador ‚îÇ   ‚îÇ  7 vistas   ‚îÇ   ‚îÇ Reutilizables‚îÇ                  ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                   ‚îÇ
‚îÇ                                                                          ‚îÇ
‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê               ‚îÇ
‚îÇ   ‚îÇ                    Services/                         ‚îÇ               ‚îÇ
‚îÇ   ‚îÇ  apiService.js ‚îÇ historyService.js ‚îÇ configService.js‚îÇ              ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                    ‚îÇ
                                    ‚îÇ HTTPS (REST API)
                                    ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                           AWS API GATEWAY                                ‚îÇ
‚îÇ                                                                          ‚îÇ
‚îÇ   POST /presigned-url  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫  Lambda: get-presigned-url              ‚îÇ
‚îÇ   POST /moderate       ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫  Lambda: moderate-image                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                    ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ                               ‚îÇ
                    ‚ñº                               ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ        AWS S3 BUCKET        ‚îÇ   ‚îÇ        AMAZON REKOGNITION           ‚îÇ
‚îÇ                             ‚îÇ   ‚îÇ                                      ‚îÇ
‚îÇ  uploads/                   ‚îÇ   ‚îÇ  detectModerationLabels()           ‚îÇ
‚îÇ    ‚îî‚îÄ‚îÄ timestamp-image.jpg  ‚îÇ‚óÑ‚îÄ‚îÄ‚îÇ  - Analiza imagen                   ‚îÇ
‚îÇ                             ‚îÇ   ‚îÇ  - Retorna etiquetas de moderaci√≥n  ‚îÇ
‚îÇ  Almacenamiento temporal    ‚îÇ   ‚îÇ  - Calcula niveles de confianza     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Comunicaci√≥n entre Componentes

1. **Usuario ‚Üí Frontend**: Interacci√≥n visual (clicks, drag & drop)
2. **Frontend ‚Üí API Gateway**: Peticiones HTTP POST
3. **API Gateway ‚Üí Lambda**: Invocaci√≥n de funciones
4. **Lambda ‚Üí S3**: Generaci√≥n de URLs firmadas, almacenamiento
5. **Lambda ‚Üí Rekognition**: An√°lisis de contenido
6. **Rekognition ‚Üí Lambda ‚Üí Frontend**: Respuesta con etiquetas

---

## 3. Tecnolog√≠as Utilizadas

### Frontend

| Tecnolog√≠a | Versi√≥n | Prop√≥sito |
|------------|---------|-----------|
| **React** | 19.2.0 | Framework de interfaz de usuario |
| **Vite** | 7.2.4 | Build tool y servidor de desarrollo |
| **Axios** | 1.7.9 | Cliente HTTP para llamadas a API |
| **Lucide React** | 0.562.0 | Librer√≠a de iconos |
| **React Dropzone** | 14.3.5 | Componente drag & drop |

### Backend (AWS)

| Servicio | Funci√≥n |
|----------|---------|
| **S3** | Almacenamiento de im√°genes (temporal) |
| **Lambda** | Procesamiento serverless (2 funciones) |
| **API Gateway** | Exposici√≥n de endpoints REST |
| **Rekognition** | An√°lisis de contenido con IA |
| **IAM** | Control de acceso y permisos |

### Almacenamiento Local

| Key | Prop√≥sito |
|-----|-----------|
| `factum_history` | Historial de an√°lisis (m√°x. 100 items) |
| `factum_config` | Configuraci√≥n del usuario |

---

## 4. Estructura de Carpetas

```
Factum-AI/
‚îÇ
‚îú‚îÄ‚îÄ README.md                      # Gu√≠a de instalaci√≥n r√°pida
‚îÇ
‚îú‚îÄ‚îÄ docs/                          # Documentaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ AWS_SETUP.md              # Gu√≠a de configuraci√≥n de AWS
‚îÇ   ‚îú‚îÄ‚îÄ DEPLOYMENT.md             # Gu√≠a de despliegue
‚îÇ   ‚îî‚îÄ‚îÄ images/                   # Im√°genes para documentaci√≥n
‚îÇ
‚îú‚îÄ‚îÄ lambda/                        # Backend (AWS Lambda Functions)
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ get-presigned-url/        # Funci√≥n 1: Generar URL firmada
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.js              # C√≥digo de la funci√≥n
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ package.json          # Dependencias (@aws-sdk/client-s3)
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ moderate-image/           # Funci√≥n 2: Moderar imagen
‚îÇ       ‚îú‚îÄ‚îÄ index.js              # C√≥digo de la funci√≥n
‚îÇ       ‚îî‚îÄ‚îÄ package.json          # Dependencias (@aws-sdk/client-rekognition)
‚îÇ
‚îî‚îÄ‚îÄ factum-app/                    # Frontend (React Application)
    ‚îÇ
    ‚îú‚îÄ‚îÄ AGENTS.MD                  # üìç ESTE ARCHIVO
    ‚îú‚îÄ‚îÄ .env                       # Variables de entorno (no en Git)
    ‚îú‚îÄ‚îÄ package.json               # Dependencias del proyecto
    ‚îú‚îÄ‚îÄ vite.config.js             # Configuraci√≥n de Vite
    ‚îú‚îÄ‚îÄ index.html                 # HTML principal
    ‚îÇ
    ‚îú‚îÄ‚îÄ public/                    # Archivos est√°ticos
    ‚îÇ
    ‚îî‚îÄ‚îÄ src/                       # C√≥digo fuente
        ‚îÇ
        ‚îú‚îÄ‚îÄ main.jsx              # Entry point de React
        ‚îú‚îÄ‚îÄ App.jsx               # Componente orquestador principal
        ‚îú‚îÄ‚îÄ App.css               # Estilos del App
        ‚îú‚îÄ‚îÄ index.css             # Estilos globales
        ‚îÇ
        ‚îú‚îÄ‚îÄ screens/              # 7 Pantallas de la aplicaci√≥n
        ‚îÇ   ‚îú‚îÄ‚îÄ Screen1/          # Upload (Zona de aterrizaje)
        ‚îÇ   ‚îú‚îÄ‚îÄ Screen2/          # Procesamiento (Loading)
        ‚îÇ   ‚îú‚îÄ‚îÄ Screen3/          # Resultado: Seguro (Verde)
        ‚îÇ   ‚îú‚îÄ‚îÄ Screen4/          # Resultado: Inseguro (Rojo)
        ‚îÇ   ‚îú‚îÄ‚îÄ Screen5/          # Historial
        ‚îÇ   ‚îú‚îÄ‚îÄ Screen6/          # Configuraci√≥n
        ‚îÇ   ‚îî‚îÄ‚îÄ ScreenSuggestive/ # Resultado: Sugestivo (Amarillo)
        ‚îÇ
        ‚îú‚îÄ‚îÄ components/           # Componentes reutilizables
        ‚îÇ   ‚îú‚îÄ‚îÄ Navigation/       # Barra de navegaci√≥n
        ‚îÇ   ‚îú‚îÄ‚îÄ ProgressSteps/    # Indicador de pasos
        ‚îÇ   ‚îú‚îÄ‚îÄ ProgressBar/      # Barra de progreso
        ‚îÇ   ‚îú‚îÄ‚îÄ ImagePreview/     # Vista previa de imagen
        ‚îÇ   ‚îú‚îÄ‚îÄ HistoryCard/      # Tarjeta de historial
        ‚îÇ   ‚îú‚îÄ‚îÄ ImageUploader.jsx # Componente de subida
        ‚îÇ   ‚îî‚îÄ‚îÄ ModerationResult.jsx # Componente de resultado
        ‚îÇ
        ‚îú‚îÄ‚îÄ services/             # Servicios de datos
        ‚îÇ   ‚îú‚îÄ‚îÄ apiService.js     # Comunicaci√≥n con AWS
        ‚îÇ   ‚îú‚îÄ‚îÄ historyService.js # Gesti√≥n de historial (localStorage)
        ‚îÇ   ‚îî‚îÄ‚îÄ configService.js  # Gesti√≥n de configuraci√≥n
        ‚îÇ
        ‚îú‚îÄ‚îÄ hooks/                # Custom React Hooks
        ‚îÇ   ‚îú‚îÄ‚îÄ useImageUpload.js # Hook para subida de im√°genes
        ‚îÇ   ‚îú‚îÄ‚îÄ useModeration.js  # Hook para moderaci√≥n
        ‚îÇ   ‚îî‚îÄ‚îÄ useHistory.js     # Hook para historial
        ‚îÇ
        ‚îî‚îÄ‚îÄ utils/                # Utilidades
            ‚îú‚îÄ‚îÄ constants.js      # Constantes globales
            ‚îî‚îÄ‚îÄ helpers.js        # Funciones auxiliares
```

---

## 5. Frontend - Aplicaci√≥n React

### 5.1 App.jsx - El Orquestador Principal

El archivo `App.jsx` es el **cerebro** de la aplicaci√≥n. No contiene l√≥gica de negocio, solo gestiona:

- **Estado global**: `currentScreen`, `imageData`, `moderationResult`
- **Navegaci√≥n**: Cambio entre las 7 pantallas
- **Comunicaci√≥n**: Callbacks entre screens
- **Clasificaci√≥n**: Determina el nivel de contenido (safe/suggestive/unsafe)

#### Estados Principales

```javascript
const [currentScreen, setCurrentScreen] = useState(1);  // Pantalla actual (1-7)
const [imageData, setImageData] = useState(null);       // Datos de la imagen subida
const [moderationResult, setModerationResult] = useState(null); // Resultado del an√°lisis
```

#### Funci√≥n de Clasificaci√≥n

La funci√≥n `detectContentStatus()` analiza las etiquetas de Rekognition y determina el nivel:

```javascript
const detectContentStatus = (result) => {
  // GRUPO 1: INSEGURO (bloqueo autom√°tico)
  const UNSAFE_PARENTS = ['Explicit Nudity', 'Violence', 'Visually Disturbing', 'Hate Symbols'];
  
  // GRUPO 2: SUGESTIVO (revisi√≥n manual)
  const SUGGESTIVE_PARENTS = ['Suggestive', 'Tobacco', 'Alcohol', 'Drugs'];
  const SUGGESTIVE_LABELS = ['Revealing Clothes', 'Swimwear or Underwear', 'Partial Nudity'];
  
  // L√≥gica de clasificaci√≥n (el orden importa)
  if (result.isInappropriate) return 'unsafe';
  if (labels.some(l => UNSAFE_PARENTS.includes(l.Name))) return 'unsafe';
  if (labels.some(l => SUGGESTIVE_LABELS.includes(l.Name))) return 'suggestive';
  return 'safe';
};
```

#### Flujo de Navegaci√≥n

```
Screen 1 (Upload)
    ‚îÇ
    ‚ñº [imagen seleccionada]
Screen 2 (Procesamiento)
    ‚îÇ
    ‚îú‚îÄ‚îÄ‚ñ∂ Screen 3 (Seguro)      ‚Üí si status === 'safe'
    ‚îú‚îÄ‚îÄ‚ñ∂ Screen 4 (Inseguro)    ‚Üí si status === 'unsafe'
    ‚îî‚îÄ‚îÄ‚ñ∂ Screen 7 (Sugestivo)   ‚Üí si status === 'suggestive'
```

### 5.2 Las 7 Pantallas

#### Screen 1: Zona de Aterrizaje (Upload)

**Archivo**: `screens/Screen1/Screen1.jsx`

**Prop√≥sito**: Permitir al usuario subir una imagen.

**Caracter√≠sticas**:
- √Årea de drag & drop usando `react-dropzone`
- Validaci√≥n de formatos (JPG, PNG, GIF, WEBP)
- L√≠mite de tama√±o: 10MB
- Vista previa de imagen seleccionada
- Progreso de subida visual

**Props recibidos**:
- `onNavigate(screenNumber)` - Navegar a otra pantalla
- `onImageSelected(data)` - Pasar datos de imagen al App

**Flujo interno**:
1. Usuario arrastra/selecciona imagen
2. Se valida tipo y tama√±o
3. Se solicita URL prefirmada a Lambda
4. Se sube imagen directamente a S3
5. Se activa `onImageSelected({ key, name, url })`
6. Se navega autom√°ticamente a Screen 2

---

#### Screen 2: Procesamiento

**Archivo**: `screens/Screen2/Screen2.jsx`

**Prop√≥sito**: Mostrar el progreso del an√°lisis con IA.

**Caracter√≠sticas**:
- Skeleton loader animado
- Indicador de pasos con estados:
  - ‚úÖ Subiendo a S3 (completado)
  - ‚úÖ Invocando Lambda (completado)
  - ‚è≥ Consultando Rekognition (en progreso)
- Dots animados (efecto bounce)
- Transici√≥n autom√°tica al completar

**Props recibidos**:
- `imageData` - Datos de la imagen (key, name, url)
- `onAnalysisComplete(result)` - Callback con resultado
- `onNavigate(screenNumber)` - Navegaci√≥n

**Flujo interno**:
1. Al montar, inicia an√°lisis autom√°ticamente
2. Llama a `moderateImage(imageKey)` del apiService
3. Actualiza visual de cada paso
4. Al completar, llama `onAnalysisComplete(result)`
5. App.jsx redirige a Screen 3, 4 o 7

---

#### Screen 3: Contenido Seguro

**Archivo**: `screens/Screen3/Screen3.jsx`

**Prop√≥sito**: Mostrar resultado positivo (imagen segura).

**Caracter√≠sticas**:
- Icono de escudo verde
- Vista previa de imagen analizada
- Barras de progreso con categor√≠as detectadas
- Bot√≥n "Aprobar y Publicar"
- Mensaje de √©xito

**Props recibidos**:
- `moderationResult` - Resultado del an√°lisis
- `imageUrl` - URL de la imagen analizada
- `onReset()` - Volver a Screen 1

---

#### Screen 4: Contenido Inseguro

**Archivo**: `screens/Screen4/Screen4.jsx`

**Prop√≥sito**: Mostrar resultado negativo (contenido peligroso).

**Caracter√≠sticas**:
- Imagen difuminada con overlay
- Icono X rojo en c√≠rculo
- Advertencia de contenido sensible
- Barras de detecci√≥n con niveles
- Bot√≥n "Revelar (Solo Admin)"
- Botones: Rechazar / Solicitar Revisi√≥n

**Props recibidos**:
- `moderationResult` - Resultado del an√°lisis
- `imageUrl` - URL de la imagen
- `onReset()` - Volver a Screen 1

---

#### Screen 5: Historial

**Archivo**: `screens/Screen5/Screen5.jsx`

**Prop√≥sito**: Ver an√°lisis previos guardados.

**Caracter√≠sticas**:
- Filtros por estado: Todos / Seguros / Sugestivos / Inseguros
- Grilla responsive (4 ‚Üí 3 ‚Üí 2 ‚Üí 1 columnas)
- Cards con borde de color seg√∫n estado
- Estad√≠sticas globales (total, seguros, sugestivos, inseguros)
- Datos persistidos en localStorage

**Funcionamiento**:
1. Lee datos de `localStorage.factum_history`
2. Aplica filtros seg√∫n selecci√≥n
3. Muestra tarjetas con `HistoryCard`
4. Permite limpiar historial

---

#### Screen 6: Configuraci√≥n

**Archivo**: `screens/Screen6/Screen6.jsx`

**Prop√≥sito**: Ajustar par√°metros de moderaci√≥n.

**Caracter√≠sticas**:
- Slider para threshold (0-100%)
- Toggles para tipos de detecci√≥n:
  - Detectar Desnudez Expl√≠cita (on/off)
  - Detectar Contenido Sugestivo (on/off)
- Bot√≥n "Guardar Configuraci√≥n"
- Mensaje de confirmaci√≥n
- Datos persistidos en localStorage

---

#### Screen 7 (ScreenSuggestive): Contenido Sugestivo

**Archivo**: `screens/ScreenSuggestive/ScreenSuggestive.jsx`

**Prop√≥sito**: Mostrar contenido que requiere revisi√≥n manual.

**Caracter√≠sticas**:
- Icono de advertencia amarillo
- Imagen visible (no bloqueada)
- Mensaje explicativo del nivel de riesgo
- Botones: Aprobar / Rechazar / Revisar
- Barras con etiquetas detectadas

---

### 5.3 Componentes Reutilizables

#### Navigation

**Archivo**: `components/Navigation/Navigation.jsx`

Barra de navegaci√≥n superior.

```jsx
<Navigation 
  currentScreen={1}           // Pantalla actual resaltada
  onNavigate={(num) => {...}} // Funci√≥n para cambiar pantalla
/>
```

**Botones**: Upload | Procesando | Seguro | Inseguro | Historial | Config

---

#### ProgressSteps

**Archivo**: `components/ProgressSteps/ProgressSteps.jsx`

Indicador de pasos con iconos y estados.

```jsx
<ProgressSteps steps={[
  { id: 's3', title: '1. Subiendo a S3...', status: 'completed' },
  { id: 'lambda', title: '2. Invocando Lambda...', status: 'loading' },
  { id: 'rekognition', title: '3. Consultando Rekognition...', status: 'pending' }
]} />
```

**Estados posibles**: `pending` | `loading` | `completed` | `error`

---

#### ProgressBar

**Archivo**: `components/ProgressBar/ProgressBar.jsx`

Barra de progreso horizontal.

```jsx
<ProgressBar 
  label="Desnudez"    // Nombre de la categor√≠a
  value={0.85}        // Valor de 0 a 1
  color="#ef4444"     // Color de la barra
/>
```

---

#### ImagePreview

**Archivo**: `components/ImagePreview/ImagePreview.jsx`

Vista previa de imagen con soporte para blur.

```jsx
<ImagePreview 
  imageUrl="https://..."   // URL de la imagen
  blurred={true}           // Aplicar difuminado
  showRevealBtn={true}     // Mostrar bot√≥n revelar
  onReveal={() => {...}}   // Callback al revelar
/>
```

---

#### HistoryCard

**Archivo**: `components/HistoryCard/HistoryCard.jsx`

Tarjeta individual para el historial.

```jsx
<HistoryCard item={{
  status: 'safe',           // 'safe' | 'suggestive' | 'unsafe'
  imageName: 'foto.jpg',
  date: '2025-01-26',
  confidence: 95.5,
  labels: [...]
}} />
```

---

## 6. Backend - AWS Lambda

### 6.1 Lambda: get-presigned-url

**Ubicaci√≥n**: `lambda/get-presigned-url/index.js`

**Prop√≥sito**: Generar una URL firmada temporal para subir im√°genes a S3.

#### Entrada (Request Body)

```json
{
  "fileName": "imagen.jpg",
  "fileType": "image/jpeg"
}
```

#### Salida (Response)

```json
{
  "uploadUrl": "https://bucket.s3.amazonaws.com/uploads/...",
  "imageKey": "uploads/1706300000000-imagen.jpg",
  "expiresIn": 300
}
```

#### L√≥gica Interna

1. Recibe nombre y tipo de archivo
2. Valida que sea una imagen (`fileType.startsWith('image/')`)
3. Genera key √∫nico: `uploads/{timestamp}-{fileName}`
4. Crea URL prefirmada con expiraci√≥n de 5 minutos
5. Retorna URL y key

#### Variables de Entorno Requeridas

| Variable | Descripci√≥n |
|----------|-------------|
| `S3_BUCKET_NAME` | Nombre del bucket S3 |
| `AWS_REGION` | Regi√≥n de AWS (ej: us-east-2) |

#### Dependencias

```json
{
  "@aws-sdk/client-s3": "^3.x",
  "@aws-sdk/s3-request-presigner": "^3.x"
}
```

---

### 6.2 Lambda: moderate-image

**Ubicaci√≥n**: `lambda/moderate-image/index.js`

**Prop√≥sito**: Analizar una imagen con Amazon Rekognition.

#### Entrada (Request Body)

```json
{
  "imageKey": "uploads/1706300000000-imagen.jpg"
}
```

#### Salida (Response)

```json
{
  "isInappropriate": true,
  "confidence": 95.5,
  "labels": [
    {
      "Name": "Explicit Nudity",
      "Confidence": 95.5,
      "ParentName": "Nudity"
    }
  ],
  "message": "Se detect√≥ contenido inapropiado...",
  "threshold": 70
}
```

#### L√≥gica Interna

1. Recibe key de imagen en S3
2. Llama a `detectModerationLabels()` de Rekognition
3. Analiza etiquetas detectadas
4. Determina si es inapropiado bas√°ndose en:
   - Categor√≠as: `Explicit Nudity`, `Violence`, etc.
   - Umbral de confianza: 70%
5. Retorna resultado estructurado

#### Categor√≠as Expl√≠citas (Bloqueo Autom√°tico)

```javascript
const explicitCategories = [
  'Explicit Nudity',
  'Nudity',
  'Graphic Male Nudity',
  'Graphic Female Nudity',
  'Sexual Activity',
  'Illustrated Explicit Nudity',
  'Adult Toys'
];
```

#### Variables de Entorno Requeridas

| Variable | Descripci√≥n |
|----------|-------------|
| `S3_BUCKET_NAME` | Nombre del bucket S3 |
| `AWS_REGION` | Regi√≥n de AWS |

#### Dependencias

```json
{
  "@aws-sdk/client-rekognition": "^3.x"
}
```

---

## 7. Flujo de Datos Completo

### Paso a Paso Detallado

```
PASO 1: USUARIO SUBE IMAGEN
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Usuario ‚Üí Screen1.jsx
  ‚îÇ
  ‚îú‚îÄ Arrastra imagen al √°rea de drop
  ‚îú‚îÄ react-dropzone detecta el archivo
  ‚îú‚îÄ Valida: tipo (image/*) y tama√±o (< 10MB)
  ‚îî‚îÄ Crea preview local con FileReader

PASO 2: OBTENER URL PREFIRMADA
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Screen1.jsx ‚Üí apiService.getPresignedUrl()
  ‚îÇ
  ‚îú‚îÄ POST a: {API_GATEWAY}/presigned-url
  ‚îÇ   Body: { fileName: "foto.jpg", fileType: "image/jpeg" }
  ‚îÇ
  ‚ñº
API Gateway ‚Üí Lambda: get-presigned-url
  ‚îÇ
  ‚îú‚îÄ Genera key: "uploads/1706300000000-foto.jpg"
  ‚îú‚îÄ Crea URL prefirmada (v√°lida 5 minutos)
  ‚îî‚îÄ Retorna: { uploadUrl, imageKey, expiresIn }

PASO 3: SUBIR IMAGEN A S3
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
apiService.uploadToS3(presignedUrl, file)
  ‚îÇ
  ‚îú‚îÄ PUT directo a S3 usando la URL prefirmada
  ‚îú‚îÄ Headers: Content-Type: image/jpeg
  ‚îî‚îÄ Imagen guardada en: s3://bucket/uploads/{key}

PASO 4: TRANSICI√ìN A PROCESAMIENTO
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Screen1.jsx
  ‚îÇ
  ‚îú‚îÄ Llama: onImageSelected({ key, name, url })
  ‚îú‚îÄ App.jsx actualiza: setImageData(data)
  ‚îî‚îÄ App.jsx navega: setCurrentScreen(2)

PASO 5: AN√ÅLISIS CON REKOGNITION
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Screen2.jsx ‚Üí apiService.moderateImage(imageKey)
  ‚îÇ
  ‚îú‚îÄ POST a: {API_GATEWAY}/moderate
  ‚îÇ   Body: { imageKey: "uploads/..." }
  ‚îÇ
  ‚ñº
API Gateway ‚Üí Lambda: moderate-image
  ‚îÇ
  ‚îú‚îÄ Llama a: rekognition.detectModerationLabels()
  ‚îÇ   Par√°metros: { Image: { S3Object: { Bucket, Name } } }
  ‚îÇ
  ‚ñº
Amazon Rekognition
  ‚îÇ
  ‚îú‚îÄ Analiza contenido de la imagen
  ‚îú‚îÄ Detecta etiquetas de moderaci√≥n
  ‚îî‚îÄ Retorna: [ { Name, Confidence, ParentName }, ... ]

PASO 6: PROCESAMIENTO DE RESULTADO
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Lambda: moderate-image
  ‚îÇ
  ‚îú‚îÄ Eval√∫a etiquetas vs categor√≠as expl√≠citas
  ‚îú‚îÄ Calcula: isInappropriate = true/false
  ‚îú‚îÄ Prepara mensaje en espa√±ol
  ‚îî‚îÄ Retorna: { isInappropriate, labels, confidence, message }

PASO 7: CLASIFICACI√ìN Y REDIRECCI√ìN
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
App.jsx ‚Üí handleAnalysisComplete(result)
  ‚îÇ
  ‚îú‚îÄ Llama: detectContentStatus(result)
  ‚îÇ   ‚îî‚îÄ Eval√∫a labels contra taxonom√≠a
  ‚îÇ   ‚îî‚îÄ Retorna: 'safe' | 'suggestive' | 'unsafe'
  ‚îÇ
  ‚îú‚îÄ Enriquece resultado: { ...result, status: 'safe' }
  ‚îú‚îÄ Guarda en historial: saveToHistory(imageData, result)
  ‚îÇ
  ‚îî‚îÄ Navega seg√∫n status:
      ‚îú‚îÄ 'safe'       ‚Üí Screen 3 (Verde)
      ‚îú‚îÄ 'suggestive' ‚Üí Screen 7 (Amarillo)
      ‚îî‚îÄ 'unsafe'     ‚Üí Screen 4 (Rojo)

PASO 8: MOSTRAR RESULTADO
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Screen3/4/7.jsx
  ‚îÇ
  ‚îú‚îÄ Muestra imagen (con/sin blur seg√∫n pantalla)
  ‚îú‚îÄ Muestra barras de categor√≠as detectadas
  ‚îú‚îÄ Muestra mensaje de estado
  ‚îî‚îÄ Ofrece acciones: Aprobar/Rechazar/Revisar

PASO 9: RESET (OPCIONAL)
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Usuario click "Nuevo An√°lisis"
  ‚îÇ
  ‚îî‚îÄ onReset() ‚Üí App.jsx:
      ‚îú‚îÄ setImageData(null)
      ‚îú‚îÄ setModerationResult(null)
      ‚îî‚îÄ setCurrentScreen(1)
```

---

## 8. Sistema de Clasificaci√≥n de Contenido

### Taxonom√≠a Oficial de Amazon Rekognition

#### Nivel 1: INSEGURO (Bloqueo Autom√°tico)

| Categor√≠a | Descripci√≥n |
|-----------|-------------|
| `Explicit Nudity` | Desnudez expl√≠cita |
| `Graphic Male Nudity` | Desnudez masculina gr√°fica |
| `Graphic Female Nudity` | Desnudez femenina gr√°fica |
| `Sexual Activity` | Actividad sexual expl√≠cita |
| `Illustrated Explicit Nudity` | Desnudez expl√≠cita ilustrada |
| `Adult Toys` | Juguetes para adultos |
| `Violence` | Violencia f√≠sica, armas en uso |
| `Visually Disturbing` | Gore, mutilaciones |
| `Hate Symbols` | S√≠mbolos de odio, nazis |

#### Nivel 2: SUGESTIVO (Revisi√≥n Manual)

| Categor√≠a | Descripci√≥n |
|-----------|-------------|
| `Suggestive` | Contenido sexualmente sugestivo |
| `Revealing Clothes` | Ropa reveladora |
| `Swimwear or Underwear` | Trajes de ba√±o, ropa interior |
| `Partial Nudity` | Desnudez parcial |
| `Barechested` | Torso descubierto |
| `Tobacco` | Productos de tabaco |
| `Alcohol` | Bebidas alcoh√≥licas |
| `Drugs` | Sustancias controladas |
| `Gambling` | Contenido de apuestas |

#### Nivel 3: SEGURO

Todo lo que no coincida con las categor√≠as anteriores.

### L√≥gica de Clasificaci√≥n en el Frontend

```javascript
// Orden de prioridad: primero lo m√°s grave
1. Si backend.isInappropriate === true ‚Üí 'unsafe'
2. Si labels contiene UNSAFE_PARENTS ‚Üí 'unsafe'
3. Si labels contiene SUGGESTIVE ‚Üí 'suggestive'
4. Default ‚Üí 'safe'
```

---

## 9. Servicios y Utilidades

### 9.1 apiService.js

**Ubicaci√≥n**: `src/services/apiService.js`

Maneja toda la comunicaci√≥n con AWS.

#### Funciones Exportadas

```javascript
// Obtener URL prefirmada para subir a S3
export const getPresignedUrl = async (fileName, fileType) => {
  // POST a /presigned-url
  // Retorna: { uploadUrl, imageKey }
}

// Subir imagen usando URL prefirmada
export const uploadToS3 = async (presignedUrl, file) => {
  // PUT directo a S3
}

// Solicitar an√°lisis de moderaci√≥n
export const moderateImage = async (imageKey, threshold = 85) => {
  // POST a /moderate
  // Retorna: { isInappropriate, labels, confidence, message }
}
```

---

### 9.2 historyService.js

**Ubicaci√≥n**: `src/services/historyService.js`

Gestiona el historial en localStorage.

#### Funciones Exportadas

```javascript
// Guardar an√°lisis en historial
export const saveToHistory = (imageData, result) => {
  // A√±ade al inicio del array
  // L√≠mite: 100 items m√°ximo
}

// Obtener todo el historial
export const getHistory = () => {
  // Lee de localStorage.factum_history
  // Retorna: array de items
}

// Filtrar historial por estado
export const filterHistory = (status) => {
  // status: 'all' | 'safe' | 'suggestive' | 'unsafe'
}

// Limpiar historial
export const clearHistory = () => {
  // Elimina factum_history de localStorage
}

// Obtener estad√≠sticas
export const getStats = () => {
  // Retorna: { total, safe, suggestive, unsafe }
}
```

#### Estructura de un Item de Historial

```javascript
{
  id: "uuid-generado",
  imageName: "foto.jpg",
  status: "safe",           // 'safe' | 'suggestive' | 'unsafe'
  confidence: 95.5,
  labels: [...],
  date: "2025-01-26T12:00:00.000Z",
  timestamp: 1706270400000
}
```

---

### 9.3 configService.js

**Ubicaci√≥n**: `src/services/configService.js`

Gestiona la configuraci√≥n del usuario.

#### Configuraci√≥n por Defecto

```javascript
const DEFAULT_CONFIG = {
  threshold: 85,              // Umbral de confianza (0-100)
  explicitNudity: true,       // Detectar desnudez expl√≠cita
  suggestive: false           // Detectar contenido sugestivo
};
```

#### Funciones Exportadas

```javascript
// Obtener configuraci√≥n actual
export const getConfig = () => {
  // Lee de localStorage.factum_config
  // Retorna configuraci√≥n con defaults
}

// Guardar configuraci√≥n
export const saveConfig = (config) => {
  // Merge con defaults
  // Guarda en localStorage
}

// Resetear a valores por defecto
export const resetConfig = () => {
  // Elimina factum_config
}
```

---

## 10. Configuraci√≥n de Variables de Entorno

### Archivo `.env` en `factum-app/`

```env
# ============================================
# CONFIGURACI√ìN DE AWS PARA FACTUM AI
# ============================================

# URL de tu API Gateway (SIN barra al final)
# Ejemplo: https://abc123xyz.execute-api.us-east-2.amazonaws.com/prod
VITE_API_GATEWAY_URL=https://tu-api-id.execute-api.us-east-2.amazonaws.com/prod

# Regi√≥n de AWS donde est√°n tus servicios
# Opciones comunes: us-east-1, us-east-2, us-west-2, eu-west-1
VITE_AWS_REGION=us-east-2

# Nombre de tu bucket S3 (debe coincidir con el de Lambda)
VITE_S3_BUCKET_NAME=tu-bucket-name
```

### C√≥mo Obtener Estos Valores

1. **VITE_API_GATEWAY_URL**:
   - AWS Console ‚Üí API Gateway ‚Üí Tu API ‚Üí Stages ‚Üí prod
   - Copiar "Invoke URL"

2. **VITE_AWS_REGION**:
   - La regi√≥n donde creaste tus recursos (ej: us-east-2)

3. **VITE_S3_BUCKET_NAME**:
   - AWS Console ‚Üí S3 ‚Üí Nombre de tu bucket

### Variables en Lambda

Cada funci√≥n Lambda tambi√©n necesita variables:

| Lambda | Variable | Valor |
|--------|----------|-------|
| get-presigned-url | `S3_BUCKET_NAME` | tu-bucket-name |
| get-presigned-url | `AWS_REGION` | us-east-2 |
| moderate-image | `S3_BUCKET_NAME` | tu-bucket-name |
| moderate-image | `AWS_REGION` | us-east-2 |

---

## 11. Gu√≠a de Despliegue

### Desarrollo Local

```bash
# 1. Clonar repositorio
git clone https://github.com/T0NY24/Factum-AI.git
cd Factum-AI

# 2. Instalar dependencias del frontend
cd factum-app
npm install

# 3. Configurar .env (ver secci√≥n anterior)
cp .env.example .env
# Editar .env con tus valores de AWS

# 4. Ejecutar servidor de desarrollo
npm run dev
# Abrir http://localhost:5173
```

### Desplegar Lambdas

```bash
# Lambda 1: get-presigned-url
cd lambda/get-presigned-url
npm install
zip -r function.zip .
# Subir function.zip a AWS Lambda

# Lambda 2: moderate-image
cd ../moderate-image
npm install
zip -r function.zip .
# Subir function.zip a AWS Lambda
```

### Build de Producci√≥n

```bash
cd factum-app
npm run build
# Los archivos se generan en dist/
```

### Opciones de Hosting

1. **AWS Amplify**: Conexi√≥n directa a GitHub
2. **AWS S3 + CloudFront**: Hosting est√°tico
3. **Vercel/Netlify**: Integraci√≥n sencilla

---

## 12. Soluci√≥n de Problemas

### Error: CORS en API Gateway

**S√≠ntoma**: Error "Access to fetch at ... has been blocked by CORS policy"

**Soluci√≥n**:
1. API Gateway ‚Üí Recurso ‚Üí Enable CORS
2. Marcar: POST, OPTIONS
3. Redesplegar la API

---

### Error: URL Prefirmada Expirada

**S√≠ntoma**: Error al subir imagen despu√©s de esperar

**Causa**: Las URLs expiran en 5 minutos

**Soluci√≥n**: Reintentar subida (genera nueva URL autom√°ticamente)

---

### Error: Access Denied en S3

**S√≠ntoma**: 403 Forbidden al subir imagen

**Soluci√≥n**:
1. Verificar permisos IAM del rol de Lambda
2. Verificar configuraci√≥n CORS del bucket S3
3. Confirmar que el bucket existe

---

### Error: Rekognition No Detecta Nada

**S√≠ntoma**: Resultado siempre vac√≠o

**Posibles causas**:
1. Imagen no se subi√≥ correctamente a S3
2. Permisos de Lambda para leer S3
3. MinConfidence muy alto

**Soluci√≥n**: Revisar CloudWatch Logs de la Lambda

---

### Las Screens 3/4/7 Aparecen Vac√≠as

**S√≠ntoma**: Pantallas de resultado sin datos

**Causa**: Se accedi√≥ directamente sin pasar por el flujo

**Soluci√≥n**: Iniciar desde Screen 1 (Upload)

---

## üìù Notas Finales

### Lo que S√ç hace este proyecto

- ‚úÖ Moderar im√°genes est√°ticas (JPG, PNG, GIF, WEBP)
- ‚úÖ Clasificar en 3 niveles de riesgo
- ‚úÖ Guardar historial localmente
- ‚úÖ Configurar umbrales de detecci√≥n

### Lo que NO hace este proyecto

- ‚ùå Autenticaci√≥n de usuarios
- ‚ùå Base de datos persistente (solo localStorage)
- ‚ùå Moderaci√≥n de videos
- ‚ùå Moderaci√≥n de texto
- ‚ùå Tests automatizados

### Mejoras Futuras Sugeridas

1. **Autenticaci√≥n**: AWS Cognito
2. **Base de datos**: DynamoDB para historial persistente
3. **Video**: Soporte para moderaci√≥n de video
4. **Tests**: Jest + React Testing Library
5. **CI/CD**: GitHub Actions + AWS Amplify

---

**√öltima actualizaci√≥n**: 2025-01-26  
**Versi√≥n**: 3.0.0 (Actualizaci√≥n completa con sistema 3-tier)
