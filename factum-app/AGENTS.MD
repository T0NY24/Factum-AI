# AGENTS.MD - DocumentaciÃ³n del Proyecto Factum AI

## ğŸ“‹ Ãndice

1. [Resumen del Proyecto](#resumen-del-proyecto)
2. [Arquitectura General](#arquitectura-general)
3. [Estructura de Carpetas](#estructura-de-carpetas)
4. [Frontend - React](#frontend---react)
5. [Backend - AWS](#backend---aws)
6. [Flujo de Datos](#flujo-de-datos)
7. [Componentes Detallados](#componentes-detallados)
8. [Servicios y Utilidades](#servicios-y-utilidades)
9. [ConfiguraciÃ³n](#configuraciÃ³n)
10. [Deployment](#deployment)

---

## ğŸ“– Resumen del Proyecto

**Factum AI** es una aplicaciÃ³n web de moderaciÃ³n de contenido que utiliza **Amazon Rekognition** para detectar contenido inapropiado en imÃ¡genes. La aplicaciÃ³n permite subir imÃ¡genes, analizarlas con IA, y clasificarlas como seguras o inapropiadas.

### TecnologÃ­as Principales

- **Frontend**: React 19, Vite, Lucide React (iconos)
- **Backend**: AWS (S3, Lambda, API Gateway, Rekognition)
- **Almacenamiento**: S3 (imÃ¡genes), LocalStorage (historial y configuraciÃ³n)
- **Deployment**: Vite (dev), AWS (producciÃ³n)

### CaracterÃ­sticas Clave

âœ… **Upload de imÃ¡genes** con drag & drop  
âœ… **AnÃ¡lisis con IA** usando Amazon Rekognition  
âœ… **6 pantallas navegables** con diseÃ±o modular  
âœ… **Historial persistente** en localStorage  
âœ… **ConfiguraciÃ³n personalizable** (threshold, detecciones)  
âœ… **Arquitectura modular** fÃ¡cil de mantener

---

## ğŸ— Arquitectura General

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      USUARIO (Browser)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ HTTP/HTTPS
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FRONTEND (React + Vite)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  App.jsx (Orquestador)                               â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ Navigation                                       â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ Screen1 (Upload)                                 â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ Screen2 (Processing)                             â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ Screen3 (Safe Content)                           â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ Screen4 (Unsafe Content)                         â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ Screen5 (History)                                â”‚   â”‚
â”‚  â”‚  â””â”€â”€ Screen6 (Configuration)                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Services                                             â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ apiService    (AWS API calls)                    â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ historyService (LocalStorage)                    â”‚   â”‚
â”‚  â”‚  â””â”€â”€ configService  (LocalStorage)                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ HTTPS (API Gateway)
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       AWS BACKEND                           â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ API Gatewayâ”‚â”€â”€â”€â–¶â”‚   Lambda    â”‚â”€â”€â”€â–¶â”‚   Rekognition   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                                    â”‚
â”‚         â”‚                                                    â”‚
â”‚         â–¼                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚
â”‚  â”‚     S3     â”‚  (Almacenamiento de imÃ¡genes)               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Estructura de Carpetas

```
factum-app/
â”œâ”€â”€ public/                    # Archivos estÃ¡ticos
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ screens/              # 6 pantallas independientes
â”‚   â”‚   â”œâ”€â”€ Screen1/         # Upload/Landing
â”‚   â”‚   â”‚   â”œâ”€â”€ Screen1.jsx
â”‚   â”‚   â”‚   â””â”€â”€ Screen1.css
â”‚   â”‚   â”œâ”€â”€ Screen2/         # Processing
â”‚   â”‚   â”‚   â”œâ”€â”€ Screen2.jsx
â”‚   â”‚   â”‚   â””â”€â”€ Screen2.css
â”‚   â”‚   â”œâ”€â”€ Screen3/         # Safe Content
â”‚   â”‚   â”‚   â”œâ”€â”€ Screen3.jsx
â”‚   â”‚   â”‚   â””â”€â”€ Screen3.css
â”‚   â”‚   â”œâ”€â”€ Screen4/         # Unsafe Content
â”‚   â”‚   â”‚   â”œâ”€â”€ Screen4.jsx
â”‚   â”‚   â”‚   â””â”€â”€ Screen4.css
â”‚   â”‚   â”œâ”€â”€ Screen5/         # History
â”‚   â”‚   â”‚   â”œâ”€â”€ Screen5.jsx
â”‚   â”‚   â”‚   â””â”€â”€ Screen5.css
â”‚   â”‚   â””â”€â”€ Screen6/         # Configuration
â”‚   â”‚       â”œâ”€â”€ Screen6.jsx
â”‚   â”‚       â””â”€â”€ Screen6.css
â”‚   â”‚
â”‚   â”œâ”€â”€ components/          # Componentes reutilizables
â”‚   â”‚   â”œâ”€â”€ Navigation/
â”‚   â”‚   â”‚   â”œâ”€â”€ Navigation.jsx
â”‚   â”‚   â”‚   â””â”€â”€ Navigation.css
â”‚   â”‚   â”œâ”€â”€ ProgressSteps/
â”‚   â”‚   â”‚   â”œâ”€â”€ ProgressSteps.jsx
â”‚   â”‚   â”‚   â””â”€â”€ ProgressSteps.css
â”‚   â”‚   â”œâ”€â”€ ProgressBar/
â”‚   â”‚   â”‚   â”œâ”€â”€ ProgressBar.jsx
â”‚   â”‚   â”‚   â””â”€â”€ ProgressBar.css
â”‚   â”‚   â”œâ”€â”€ ImagePreview/
â”‚   â”‚   â”‚   â”œâ”€â”€ ImagePreview.jsx
â”‚   â”‚   â”‚   â””â”€â”€ ImagePreview.css
â”‚   â”‚   â””â”€â”€ HistoryCard/
â”‚   â”‚       â”œâ”€â”€ HistoryCard.jsx
â”‚   â”‚       â””â”€â”€ HistoryCard.css
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/               # Custom React hooks
â”‚   â”‚   â”œâ”€â”€ useImageUpload.js
â”‚   â”‚   â”œâ”€â”€ useModeration.js
â”‚   â”‚   â””â”€â”€ useHistory.js
â”‚   â”‚
â”‚   â”œâ”€â”€ services/            # Servicios de datos
â”‚   â”‚   â”œâ”€â”€ apiService.js
â”‚   â”‚   â”œâ”€â”€ historyService.js
â”‚   â”‚   â””â”€â”€ configService.js
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/               # Utilidades
â”‚   â”‚   â”œâ”€â”€ constants.js
â”‚   â”‚   â””â”€â”€ helpers.js
â”‚   â”‚
â”‚   â”œâ”€â”€ App.jsx              # Componente principal
â”‚   â”œâ”€â”€ App.css              # Estilos del App
â”‚   â”œâ”€â”€ index.css            # Estilos globales
â”‚   â””â”€â”€ main.jsx             # Entry point
â”‚
â”œâ”€â”€ .env                     # Variables de entorno
â”œâ”€â”€ .env.example             # Ejemplo de .env
â”œâ”€â”€ package.json
â”œâ”€â”€ vite.config.js
â””â”€â”€ AGENTS.MD               # Este archivo
```

---

## âš›ï¸ Frontend - React

### App.jsx (Orquestador Principal)

El componente `App.jsx` actÃºa como orquestador de toda la aplicaciÃ³n. **No contiene lÃ³gica de negocio**, solo gestiona:

- **NavegaciÃ³n entre screens** (currentScreen state)
- **Estado global compartido** (imageData, moderationResult)
- **Callbacks** para comunicaciÃ³n entre screens

```javascript
function App() {
  const [currentScreen, setCurrentScreen] = useState(1);
  const [imageData, setImageData] = useState(null);
  const [moderationResult, setModerationResult] = useState(null);

  // Handlers para comunicaciÃ³n con screens
  const handleNavigate = (screenNumber) => { ... };
  const handleImageSelected = (data) => { ... };
  const handleAnalysisComplete = (result) => { ... };
  const handleReset = () => { ... };

  return (
    <div className="app">
      <Navigation currentScreen={currentScreen} onNavigate={handleNavigate} />
      <main className="app-content">
        {currentScreen === 1 && <Screen1 ... />}
        {currentScreen === 2 && <Screen2 ... />}
        // ... resto de screens
      </main>
    </div>
  );
}
```

### Pantallas (Screens)

Cada pantalla es un componente independiente con su propia lÃ³gica y estilos.

#### **Screen 1: Zona de Aterrizaje (Upload)**
- **PropÃ³sito**: Upload de imÃ¡genes con drag & drop
- **CaracterÃ­sticas**:
  - Ãrea de drag & drop con react-dropzone
  - ValidaciÃ³n de formatos (JPG, PNG, GIF, WEBP, mÃ¡x 10MB)
  - Preview de imagen seleccionada
  - Progreso de upload
  - TransiciÃ³n automÃ¡tica a Screen 2 tras upload exitoso
- **Hook usado**: `useImageUpload`

#### **Screen 2: Procesamiento**
- **PropÃ³sito**: Mostrar progreso del anÃ¡lisis
- **CaracterÃ­sticas**:
  - Skeleton loader animado
  - Indicadores de progreso paso a paso:
    1. Subiendo a S3 âœ“
    2. Invocando AWS Lambda âœ“
    3. Consultando Amazon Rekognition... â³
  - Dots animados (bounce)
  - TransiciÃ³n automÃ¡tica a Screen 3 o 4 segÃºn resultado
- **Hook usado**: `useModeration`

#### **Screen 3: Contenido Seguro**
- **PropÃ³sito**: Mostrar resultado de imagen segura
- **CaracterÃ­sticas**:
  - Icono de escudo verde
  - Preview de imagen analizada
  - Barras de progreso con categorÃ­as detectadas
  - BotÃ³n "Aprobar y Publicar"
  - Datos de demostraciÃ³n si se accede directamente
- **Props**: `moderationResult`, `imageUrl`, `onReset`

#### **Screen 4: Contenido Inapropiado**
- **PropÃ³sito**: Mostrar resultado de imagen inapropiada
- **CaracterÃ­sticas**:
  - Imagen difuminada con overlay
  - Icono X rojo en cÃ­rculo
  - Advertencia de contenido sensible
  - Barras de progreso con niveles de detecciÃ³n
  - BotÃ³n "Revelar (Solo Admin)"
  - Botones de acciÃ³n (Rechazar/Revisar)
  - Datos de demostraciÃ³n si se accede directamente
- **Props**: `moderationResult`, `imageUrl`, `onReset`

#### **Screen 5: Historial**
- **PropÃ³sito**: Ver anÃ¡lisis previos
- **CaracterÃ­sticas**:
  - Filtros por estado (Todos, Seguros, Inapropiados)
  - Grilla responsive de 4 columnas (adapta a 3â†’2â†’1)
  - Cards con bordes verde/rojo segÃºn estado
  - EstadÃ­sticas globales
  - Persistencia en localStorage
- **Hook usado**: `useHistory`

#### **Screen 6: ConfiguraciÃ³n**
- **PropÃ³sito**: Ajustar parÃ¡metros de moderaciÃ³n
- **CaracterÃ­sticas**:
  - Slider personalizado para threshold (0-100%)
  - Toggles personalizados para detecciones:
    - Detectar Desnudez ExplÃ­cita
    - Detectar Contenido Sugestivo
  - BotÃ³n "Guardar ConfiguraciÃ³n"
  - Mensaje de confirmaciÃ³n
  - Persistencia en localStorage
- **Estado local**: threshold, explicitNudity, suggestive

### Componentes Reutilizables

#### **Navigation**
Barra de navegaciÃ³n superior con 6 botones.
```javascript
<Navigation currentScreen={1} onNavigate={(num) => {...}} />
```

#### **ProgressSteps**
Indicador de pasos con iconos y estados.
```javascript
<ProgressSteps steps={[
  { id: 's3', title: '1. Subiendo a S3...', status: 'completed', message: 'Completado' },
  { id: 'lambda', title: '2. Lambda...', status: 'loading', message: 'Procesando...' },
  ...
]} />
```

#### **ProgressBar**
Barra de progreso horizontal con label y porcentaje.
```javascript
<ProgressBar label="Desnudez" value={0.01} color="#9ca3af" />
```

#### **ImagePreview**
Preview de imagen con soporte para blur.
```javascript
<ImagePreview 
  imageUrl="..." 
  blurred={true} 
  showRevealBtn={true}
  onReveal={() => {...}} 
/>
```

#### **HistoryCard**
Card individual para historial.
```javascript
<HistoryCard item={{
  status: 'safe',
  date: '2025-12-22',
  imageName: 'landscape.jpg'
}} />
```

---

## ğŸ”§ Custom Hooks

### useImageUpload
Gestiona el proceso de carga de imÃ¡genes.

```javascript
const {
  uploading,    // boolean: estÃ¡ subiendo
  progress,     // number: 0-100
  error,        // string|null: mensaje de error
  preview,      // string|null: URL de preview
  handleUpload, // function: sube archivo
  resetUpload   // function: resetea estado
} = useImageUpload();
```

**Flujo**:
1. Valida archivo (tipo, tamaÃ±o)
2. Crea preview con FileReader
3. Obtiene presigned URL de API
4. Sube a S3
5. Retorna `{ key, name, type, url }`

### useModeration
Gestiona el anÃ¡lisis de moderaciÃ³n.

```javascript
const {
  analyzing,        // boolean: estÃ¡ analizando
  result,           // object|null: resultado
  error,            // string|null: mensaje de error
  currentStep,      // string: paso actual
  steps,            // array: pasos con estados
  analyzeImage,     // function: analiza imagen
  resetModeration   // function: resetea estado
} = useModeration();
```

**Flujo**:
1. Actualiza paso a "Subiendo a S3" (ya completado)
2. Actualiza paso a "Invocando Lambda"
3. Actualiza paso a "Consultando Rekognition"
4. Llama a `moderateImage(imageKey, threshold)`
5. Retorna resultado

### useHistory
Gestiona el historial de anÃ¡lisis.

```javascript
const {
  history,          // array: lista de anÃ¡lisis
  filter,          // string: 'all'|'safe'|'unsafe'
  loading,         // boolean: estÃ¡ cargando
  applyFilter,     // function: cambia filtro
  clearHistory,    // function: limpia historial
  refreshHistory,  // function: recarga datos
  getStats         // function: retorna estadÃ­sticas
} = useHistory();
```

---

## ğŸ’¾ Servicios y Utilidades

### apiService.js

Maneja todas las comunicaciones con AWS.

```javascript
// Obtener presigned URL para upload a S3
export const getPresignedUrl = async (fileName, fileType) => {
  const response = await axios.post(`${API_BASE_URL}/presigned-url`, {
    fileName, fileType
  });
  return response.data; // { uploadUrl, imageKey }
};

// Subir imagen a S3
export const uploadToS3 = async (presignedUrl, file) => {
  await axios.put(presignedUrl, file, {
    headers: { 'Content-Type': file.type }
  });
};

// Moderar imagen con Rekognition
export const moderateImage = async (imageKey, threshold = 85) => {
  const response = await axios.post(`${API_BASE_URL}/moderate`, {
    imageKey, threshold
  });
  return response.data; 
  // { isInappropriate, labels, confidence, message }
};
```

### historyService.js

Gestiona el historial en localStorage.

```javascript
// Guardar anÃ¡lisis
export const saveToHistory = (imageData, result) => {
  const history = getHistory();
  history.unshift({
    id: generateId(),
    imageName: imageData.name,
    status: result.isInappropriate ? 'unsafe' : 'safe',
    confidence: result.confidence,
    labels: result.labels,
    date: new Date().toISOString(),
    timestamp: Date.now()
  });
  localStorage.setItem('factum_history', JSON.stringify(history.slice(0, 100)));
};

// Obtener historial
export const getHistory = () => {
  const data = localStorage.getItem('factum_history');
  return data ? JSON.parse(data) : [];
};

// Filtrar historial
export const filterHistory = (status) => {
  return getHistory().filter(item => 
    status === 'all' || item.status === status
  );
};
```

### configService.js

Gestiona la configuraciÃ³n en localStorage.

```javascript
// Valores por defecto
const DEFAULT_CONFIG = {
  threshold: 85,
  explicitNudity: true,
  suggestive: false
};

// Obtener configuraciÃ³n
export const getConfig = () => {
  const data = localStorage.getItem('factum_config');
  return data ? JSON.parse(data) : DEFAULT_CONFIG;
};

// Guardar configuraciÃ³n
export const saveConfig = (config) => {
  const merged = { ...DEFAULT_CONFIG, ...config };
  localStorage.setItem('factum_config', JSON.stringify(merged));
  return merged;
};
```

### constants.js

Constantes globales de la aplicaciÃ³n.

```javascript
export const SCREEN_NAMES = {
  1: 'Zona de Aterrizaje',
  2: 'Procesando',
  3: 'Contenido Seguro',
  4: 'Contenido Inapropiado',
  5: 'Historial',
  6: 'ConfiguraciÃ³n'
};

export const STATUS_SAFE = 'safe';
export const STATUS_UNSAFE = 'unsafe';
export const MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB
```

### helpers.js

Funciones de utilidad.

```javascript
// Formatear fecha
export const formatDate = (timestamp) => {
  return new Date(timestamp).toLocaleDateString('es-ES', {
    year: 'numeric',
    month: '2-digit',
    day: '2-digit'
  });
};

// Validar archivo
export const validateFile = (file) => {
  if (!file.type.startsWith('image/')) {
    return { valid: false, error: 'Archivo invÃ¡lido' };
  }
  if (file.size > MAX_FILE_SIZE) {
    return { valid: false, error: 'Archivo muy grande' };
  }
  return { valid: true, error: null };
};
```

---

## â˜ï¸ Backend - AWS

### Arquitectura AWS

```
API Gateway (REST API)
  â”‚
  â”œâ”€â”€â”€ POST /presigned-url  â†’ Lambda: getPresignedUrl
  â”‚                           â””â”€â†’ genera presigned URL de S3
  â”‚
  â””â”€â”€â”€ POST /moderate        â†’ Lambda: moderateImage
                              â””â”€â†’ llama a Rekognition
                              â””â”€â†’ retorna resultado
```

### Lambda Function: getPresignedUrl

```javascript
// Genera URL firmada para upload a S3
exports.handler = async (event) => {
  const { fileName, fileType } = JSON.parse(event.body);
  const imageKey = `uploads/${Date.now()}-${fileName}`;
  
  const uploadUrl = await s3.getSignedUrl('putObject', {
    Bucket: BUCKET_NAME,
    Key: imageKey,
    ContentType: fileType,
    Expires: 300  // 5 minutos
  });
  
  return {
    statusCode: 200,
    body: JSON.stringify({ uploadUrl, imageKey })
  };
};
```

### Lambda Function: moderateImage

```javascript
// Analiza imagen con Rekognition
exports.handler = async (event) => {
  const { imageKey, threshold } = JSON.parse(event.body);
  
  const result = await rekognition.detectModerationLabels({
    Image: {
      S3Object: {
        Bucket: BUCKET_NAME,
        Name: imageKey
      }
    },
    MinConfidence: threshold || 85
  }).promise();
  
  const labels = result.ModerationLabels;
  const isInappropriate = labels.length > 0;
  const confidence = labels[0]?.Confidence || 0;
  
  return {
    statusCode: 200,
    body: JSON.stringify({
      isInappropriate,
      labels,
      confidence,
      message: isInappropriate 
        ? 'Contenido inapropiado detectado'
        : 'Contenido seguro'
    })
  };
};
```

### S3 Bucket Configuration

- **Nombre**: `factum-ai-images` (ejemplo)
- **RegiÃ³n**: `us-east-2`
- **CORS**: Habilitado para requests desde frontend
- **Lifecycle**: Borrar imÃ¡genes despuÃ©s de 30 dÃ­as (opcional)

---

## ğŸ”„ Flujo de Datos

### Flujo Completo de AnÃ¡lisis

```
1. USER: Arrastra imagen en Screen1
   â””â”€â†’ Screen1.jsx: onDrop()
       â””â”€â†’ useImageUpload: handleUpload()
           â”œâ”€â†’ validateFile()
           â”œâ”€â†’ apiService: getPresignedUrl()
           â”‚   â””â”€â†’ API Gateway â†’ Lambda â†’ S3 presigned URL
           â””â”€â†’ apiService: uploadToS3()
               â””â”€â†’ S3: imagen guardada
               â””â”€â†’ onImageSelected({ key, name, url })
                   â””â”€â†’ App.jsx: setImageData()
                   â””â”€â†’ onNavigate(2) â†’ SCREEN 2

2. Screen2.jsx auto-ejecuta anÃ¡lisis
   â””â”€â†’ useModeration: analyzeImage(imageKey)
       â”œâ”€â†’ configService: getThreshold()
       â””â”€â†’ apiService: moderateImage(imageKey, threshold)
           â””â”€â†’ API Gateway â†’ Lambda â†’ Rekognition
               â””â”€â†’ resultado: { isInappropriate, labels, confidence }
                   â””â”€â†’ onAnalysisComplete(result)
                       â”œâ”€â†’ App.jsx: setModerationResult()
                       â”œâ”€â†’ historyService: saveToHistory()
                       â””â”€â†’ onNavigate(3 o 4) â†’ SCREEN 3/4

3. Screen3/4 muestra resultado
   â””â”€â†’ Usuario: "Aprobar" o "Rechazar"
       â””â”€â†’ onReset()
           â””â”€â†’ App.jsx: reset + onNavigate(1) â†’ SCREEN 1
```

---

## âš™ï¸ ConfiguraciÃ³n

### Variables de Entorno (.env)

```bash
# API Gateway URL
VITE_API_GATEWAY_URL=https://your-api-id.execute-api.us-east-2.amazonaws.com/prod

# ConfiguraciÃ³n opcional
VITE_AWS_REGION=us-east-2
VITE_S3_BUCKET=factum-ai-images
```

### package.json

```json
{
  "name": "factum-app",
  "version": "1.0.0",
  "dependencies": {
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "react-dropzone": "^14.3.5",
    "axios": "^1.7.9",
    "lucide-react": "^latest"
  },
  "devDependencies": {
    "vite": "^7.2.4",
    "@vitejs/plugin-react": "^5.1.1"
  }
}
```

---

## ğŸš€ Deployment

### Development

```bash
npm install
npm run dev
# App running on http://localhost:5173
```

### Production Build

```bash
npm run build
# Output: dist/
```

### Deploy a AWS (Amplify/S3+CloudFront)

```bash
# OpciÃ³n 1: AWS Amplify
amplify init
amplify add hosting
amplify publish

# OpciÃ³n 2: S3 + CloudFront
npm run build
aws s3 sync dist/ s3://your-bucket-name
aws cloudfront create-invalidation --distribution-id YOUR_DIST_ID --paths "/*"
```

---

## ğŸ“ Notas Importantes

### Ventajas de la Arquitectura Modular

âœ… **Escalabilidad**: FÃ¡cil agregar nuevas screens o componentes  
âœ… **Mantenibilidad**: Archivos pequeÃ±os y enfocados  
âœ… **ReutilizaciÃ³n**: Componentes compartidos entre screens  
âœ… **Testabilidad**: Cada pieza puede testearse independientemente  
âœ… **Claridad**: Estructura clara y lÃ³gica  

### Limitaciones Actuales

âš ï¸ **No hay autenticaciÃ³n**: Cualquiera puede usar la app  
âš ï¸ **No hay base de datos**: Historial solo en localStorage  
âš ï¸ **No hay tests**: Pruebas solo manuales  
âš ï¸ **No hay CI/CD**: Deployment manual  

### Mejoras Futuras Sugeridas

1. **AutenticaciÃ³n**: AWS Cognito para usuarios
2. **Database**: DynamoDB para historial persistente
3. **Tests**: Jest + React Testing Library
4. **CI/CD**: GitHub Actions + AWS Amplify
5. **Monitoring**: CloudWatch + Sentry
6. **Multi-regiÃ³n**: S3 en mÃºltiples regiones

---

## ğŸ†˜ Troubleshooting

### Error: CORS en API Gateway
**SoluciÃ³n**: Habilitar CORS en API Gateway para POST requests

### Error: Presigned URL expirado
**SoluciÃ³n**: URLs expiran en 5 min, regenerar si es necesario

### Error: Rekognition no detecta nada
**SoluciÃ³n**: Verificar threshold y tipos de detecciÃ³n habilitados

### Screen 3/4 aparecen vacÃ­as
**SoluciÃ³n**: Ya resuelto - ahora muestran datos de demostraciÃ³n

---

**Ãšltima actualizaciÃ³n**: 2025-12-22  
**VersiÃ³n**: 2.0.0 (Arquitectura Modular)
