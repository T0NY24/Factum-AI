# AGENTS.MD - DocumentaciÃ³n TÃ©cnica Completa de Factum AI

> **PropÃ³sito**: Este documento explica paso a paso cÃ³mo funciona el proyecto Factum AI para que cualquier inteligencia artificial o desarrollador pueda entenderlo completamente.

---

## ğŸ“‹ Tabla de Contenidos

1. [DescripciÃ³n General](#1-descripciÃ³n-general)
2. [Arquitectura del Sistema](#2-arquitectura-del-sistema)
3. [TecnologÃ­as Utilizadas](#3-tecnologÃ­as-utilizadas)
4. [Estructura de Carpetas](#4-estructura-de-carpetas)
5. [Frontend - AplicaciÃ³n React](#5-frontend---aplicaciÃ³n-react)
6. [Backend - AWS Lambda](#6-backend---aws-lambda)
7. [Flujo de Datos Completo](#7-flujo-de-datos-completo)
8. [Sistema de ClasificaciÃ³n de Contenido](#8-sistema-de-clasificaciÃ³n-de-contenido)
9. [Servicios y Utilidades](#9-servicios-y-utilidades)
10. [ConfiguraciÃ³n de Variables de Entorno](#10-configuraciÃ³n-de-variables-de-entorno)
11. [GuÃ­a de Despliegue](#11-guÃ­a-de-despliegue)
12. [Despliegue en ProducciÃ³n](#12-despliegue-en-producciÃ³n)
13. [SoluciÃ³n de Problemas](#13-soluciÃ³n-de-problemas)

---

## 1. DescripciÃ³n General

### Â¿QuÃ© es Factum AI?

**Factum AI** es una aplicaciÃ³n web de moderaciÃ³n de contenido que analiza imÃ¡genes usando inteligencia artificial para detectar contenido inapropiado. Utiliza **Amazon Rekognition** como motor de anÃ¡lisis.

### Â¿QuÃ© problema resuelve?

Permite a plataformas web y aplicaciones moderar automÃ¡ticamente imÃ¡genes subidas por usuarios, clasificÃ¡ndolas en tres niveles:

| Nivel | Color | AcciÃ³n | DescripciÃ³n |
|-------|-------|--------|-------------|
| **Seguro** | ğŸŸ¢ Verde | AprobaciÃ³n automÃ¡tica | Contenido apropiado para publicar |
| **Sugestivo** | ğŸŸ¡ Amarillo | RevisiÃ³n manual | Contenido que requiere decisiÃ³n humana |
| **Inseguro** | ğŸ”´ Rojo | Bloqueo automÃ¡tico | Contenido explÃ­cito o violento |

### CaracterÃ­sticas Principales

- âœ… **Drag & Drop** para subir imÃ¡genes
- âœ… **AnÃ¡lisis con IA** usando Amazon Rekognition
- âœ… **ClasificaciÃ³n en 3 niveles** (safe/suggestive/unsafe)
- âœ… **7 pantallas navegables** con diseÃ±o modular
- âœ… **Historial persistente** en localStorage
- âœ… **ConfiguraciÃ³n personalizable** de umbrales

---

## 2. Arquitectura del Sistema

### Diagrama de Arquitectura

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           USUARIO (Navegador Web)                        â”‚
â”‚                                                                          â”‚
â”‚   1. Arrastra imagen    2. Ve progreso    3. Recibe resultado           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ HTTPS
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        FRONTEND (React + Vite)                           â”‚
â”‚                                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚   â”‚   App.jsx   â”‚   â”‚  Screens/   â”‚   â”‚ Components/ â”‚                   â”‚
â”‚   â”‚ Orquestador â”‚   â”‚  7 vistas   â”‚   â”‚ Reutilizablesâ”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚   â”‚                    Services/                         â”‚               â”‚
â”‚   â”‚  apiService.js â”‚ historyService.js â”‚ configService.jsâ”‚              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ HTTPS (REST API)
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           AWS API GATEWAY                                â”‚
â”‚                                                                          â”‚
â”‚   POST /presigned-url  â”€â”€â”€â”€â”€â”€â”€â–º  Lambda: get-presigned-url              â”‚
â”‚   POST /moderate       â”€â”€â”€â”€â”€â”€â”€â–º  Lambda: moderate-image                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                               â”‚
                    â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        AWS S3 BUCKET        â”‚   â”‚        AMAZON REKOGNITION           â”‚
â”‚                             â”‚   â”‚                                      â”‚
â”‚  uploads/                   â”‚   â”‚  detectModerationLabels()           â”‚
â”‚    â””â”€â”€ timestamp-image.jpg  â”‚â—„â”€â”€â”‚  - Analiza imagen                   â”‚
â”‚                             â”‚   â”‚  - Retorna etiquetas de moderaciÃ³n  â”‚
â”‚  Almacenamiento temporal    â”‚   â”‚  - Calcula niveles de confianza     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ComunicaciÃ³n entre Componentes

1. **Usuario â†’ Frontend**: InteracciÃ³n visual (clicks, drag & drop)
2. **Frontend â†’ API Gateway**: Peticiones HTTP POST
3. **API Gateway â†’ Lambda**: InvocaciÃ³n de funciones
4. **Lambda â†’ S3**: GeneraciÃ³n de URLs firmadas, almacenamiento
5. **Lambda â†’ Rekognition**: AnÃ¡lisis de contenido
6. **Rekognition â†’ Lambda â†’ Frontend**: Respuesta con etiquetas

---

## 3. TecnologÃ­as Utilizadas

### Frontend

| TecnologÃ­a | VersiÃ³n | PropÃ³sito |
|------------|---------|-----------|
| **React** | 19.2.0 | Framework de interfaz de usuario |
| **Vite** | 7.2.4 | Build tool y servidor de desarrollo |
| **Axios** | 1.7.9 | Cliente HTTP para llamadas a API |
| **Lucide React** | 0.562.0 | LibrerÃ­a de iconos |
| **React Dropzone** | 14.3.5 | Componente drag & drop |
| **Framer Motion** | 12.31.0 | Biblioteca de animaciones |
| **Sonner** | 2.0.7 | Sistema de notificaciones toast |

### Backend (AWS)

| Servicio | FunciÃ³n |
|----------|---------|
| **S3** | Almacenamiento de imÃ¡genes (temporal) |
| **Lambda** | Procesamiento serverless (2 funciones) |
| **API Gateway** | ExposiciÃ³n de endpoints REST |
| **Rekognition** | AnÃ¡lisis de contenido con IA |
| **IAM** | Control de acceso y permisos |

### Almacenamiento Local

| Key | PropÃ³sito |
|-----|-----------|
| `factum_history` | Historial de anÃ¡lisis (mÃ¡x. 100 items) |
| `factum_config` | ConfiguraciÃ³n del usuario |

---

## 4. Estructura de Carpetas

```
Factum-AI/
â”‚
â”œâ”€â”€ README.md                      # GuÃ­a de instalaciÃ³n rÃ¡pida
â”‚
â”œâ”€â”€ docs/                          # DocumentaciÃ³n
â”‚   â”œâ”€â”€ AWS_SETUP.md              # GuÃ­a de configuraciÃ³n de AWS
â”‚   â”œâ”€â”€ DEPLOYMENT.md             # GuÃ­a de despliegue
â”‚   â””â”€â”€ images/                   # ImÃ¡genes para documentaciÃ³n
â”‚
â”œâ”€â”€ lambda/                        # Backend (AWS Lambda Functions)
â”‚   â”‚
â”‚   â”œâ”€â”€ get-presigned-url/        # FunciÃ³n 1: Generar URL firmada
â”‚   â”‚   â”œâ”€â”€ index.js              # CÃ³digo de la funciÃ³n
â”‚   â”‚   â””â”€â”€ package.json          # Dependencias (@aws-sdk/client-s3)
â”‚   â”‚
â”‚   â””â”€â”€ moderate-image/           # FunciÃ³n 2: Moderar imagen
â”‚       â”œâ”€â”€ index.js              # CÃ³digo de la funciÃ³n
â”‚       â””â”€â”€ package.json          # Dependencias (@aws-sdk/client-rekognition)
â”‚
â””â”€â”€ factum-app/                    # Frontend (React Application)
    â”‚
    â”œâ”€â”€ AGENTS.MD                  # ğŸ“ ESTE ARCHIVO
    â”œâ”€â”€ .env                       # Variables de entorno (no en Git)
    â”œâ”€â”€ package.json               # Dependencias del proyecto
    â”œâ”€â”€ vite.config.js             # ConfiguraciÃ³n de Vite
    â”œâ”€â”€ index.html                 # HTML principal
    â”‚
    â”œâ”€â”€ public/                    # Archivos estÃ¡ticos
    â”‚
    â””â”€â”€ src/                       # CÃ³digo fuente
        â”‚
        â”œâ”€â”€ main.jsx              # Entry point de React
        â”œâ”€â”€ App.jsx               # Componente orquestador principal
        â”œâ”€â”€ App.css               # Estilos del App
        â”œâ”€â”€ index.css             # Estilos globales
        â”‚
        â”œâ”€â”€ screens/              # 7 Pantallas de la aplicaciÃ³n
        â”‚   â”œâ”€â”€ Screen1/          # Upload (Zona de aterrizaje)
        â”‚   â”œâ”€â”€ Screen2/          # Procesamiento (Loading)
        â”‚   â”œâ”€â”€ Screen3/          # Resultado: Seguro (Verde)
        â”‚   â”œâ”€â”€ Screen4/          # Resultado: Inseguro (Rojo)
        â”‚   â”œâ”€â”€ Screen5/          # Historial
        â”‚   â”œâ”€â”€ Screen6/          # ConfiguraciÃ³n
        â”‚   â””â”€â”€ ScreenSuggestive/ # Resultado: Sugestivo (Amarillo)
        â”‚
        â”œâ”€â”€ components/           # Componentes reutilizables
        â”‚   â”œâ”€â”€ Navigation/       # Barra de navegaciÃ³n
        â”‚   â”œâ”€â”€ ProgressSteps/    # Indicador de pasos
        â”‚   â”œâ”€â”€ ProgressBar/      # Barra de progreso
        â”‚   â”œâ”€â”€ ImagePreview/     # Vista previa de imagen
        â”‚   â”œâ”€â”€ HistoryCard/      # Tarjeta de historial
        â”‚   â”œâ”€â”€ ImageUploader.jsx # Componente de subida
        â”‚   â””â”€â”€ ModerationResult.jsx # Componente de resultado
        â”‚
        â”œâ”€â”€ services/             # Servicios de datos
        â”‚   â”œâ”€â”€ apiService.js     # ComunicaciÃ³n con AWS
        â”‚   â”œâ”€â”€ historyService.js # GestiÃ³n de historial (localStorage)
        â”‚   â””â”€â”€ configService.js  # GestiÃ³n de configuraciÃ³n
        â”‚
        â”œâ”€â”€ hooks/                # Custom React Hooks
        â”‚   â”œâ”€â”€ useImageUpload.js # Hook para subida de imÃ¡genes
        â”‚   â”œâ”€â”€ useModeration.js  # Hook para moderaciÃ³n
        â”‚   â””â”€â”€ useHistory.js     # Hook para historial
        â”‚
        â””â”€â”€ utils/                # Utilidades
            â”œâ”€â”€ constants.js      # Constantes globales
            â””â”€â”€ helpers.js        # Funciones auxiliares
```

---

## 5. Frontend - AplicaciÃ³n React

### 5.1 App.jsx - El Orquestador Principal

El archivo `App.jsx` es el **cerebro** de la aplicaciÃ³n. No contiene lÃ³gica de negocio, solo gestiona:

- **Estado global**: `currentScreen`, `imageData`, `moderationResult`
- **NavegaciÃ³n**: Cambio entre las 7 pantallas
- **ComunicaciÃ³n**: Callbacks entre screens
- **ClasificaciÃ³n**: Determina el nivel de contenido (safe/suggestive/unsafe)

#### Estados Principales

```javascript
const [currentScreen, setCurrentScreen] = useState(1);  // Pantalla actual (1-7)
const [imageData, setImageData] = useState(null);       // Datos de la imagen subida
const [moderationResult, setModerationResult] = useState(null); // Resultado del anÃ¡lisis
```

#### FunciÃ³n de ClasificaciÃ³n

La funciÃ³n `detectContentStatus()` analiza las etiquetas de Rekognition y determina el nivel:

```javascript
const detectContentStatus = (result) => {
  // GRUPO 1: INSEGURO (bloqueo automÃ¡tico)
  const UNSAFE_PARENTS = ['Explicit Nudity', 'Violence', 'Visually Disturbing', 'Hate Symbols'];
  
  // GRUPO 2: SUGESTIVO (revisiÃ³n manual)
  const SUGGESTIVE_PARENTS = ['Suggestive', 'Tobacco', 'Alcohol', 'Drugs'];
  const SUGGESTIVE_LABELS = ['Revealing Clothes', 'Swimwear or Underwear', 'Partial Nudity'];
  
  // LÃ³gica de clasificaciÃ³n (el orden importa)
  if (result.isInappropriate) return 'unsafe';
  if (labels.some(l => UNSAFE_PARENTS.includes(l.Name))) return 'unsafe';
  if (labels.some(l => SUGGESTIVE_LABELS.includes(l.Name))) return 'suggestive';
  return 'safe';
};
```

#### Flujo de NavegaciÃ³n

```
Screen 1 (Upload)
    â”‚
    â–¼ [imagen seleccionada]
Screen 2 (Procesamiento)
    â”‚
    â”œâ”€â”€â–¶ Screen 3 (Seguro)      â†’ si status === 'safe'
    â”œâ”€â”€â–¶ Screen 4 (Inseguro)    â†’ si status === 'unsafe'
    â””â”€â”€â–¶ Screen 7 (Sugestivo)   â†’ si status === 'suggestive'
```

### 5.2 Las 7 Pantallas

#### Screen 1: Zona de Aterrizaje (Upload)

**Archivo**: `screens/Screen1/Screen1.jsx`

**PropÃ³sito**: Permitir al usuario subir una imagen.

**CaracterÃ­sticas**:
- Ãrea de drag & drop usando `react-dropzone`
- ValidaciÃ³n de formatos (JPG, PNG, GIF, WEBP)
- LÃ­mite de tamaÃ±o: 10MB
- Vista previa de imagen seleccionada
- Progreso de subida visual

**Props recibidos**:
- `onNavigate(screenNumber)` - Navegar a otra pantalla
- `onImageSelected(data)` - Pasar datos de imagen al App

**Flujo interno**:
1. Usuario arrastra/selecciona imagen
2. Se valida tipo y tamaÃ±o
3. Se solicita URL prefirmada a Lambda
4. Se sube imagen directamente a S3
5. Se activa `onImageSelected({ key, name, url })`
6. Se navega automÃ¡ticamente a Screen 2

---

#### Screen 2: Procesamiento

**Archivo**: `screens/Screen2/Screen2.jsx`

**PropÃ³sito**: Mostrar el progreso del anÃ¡lisis con IA.

**CaracterÃ­sticas**:
- Skeleton loader animado
- Indicador de pasos con estados:
  - âœ… Subiendo a S3 (completado)
  - âœ… Invocando Lambda (completado)
  - â³ Consultando Rekognition (en progreso)
- Dots animados (efecto bounce)
- TransiciÃ³n automÃ¡tica al completar

**Props recibidos**:
- `imageData` - Datos de la imagen (key, name, url)
- `onAnalysisComplete(result)` - Callback con resultado
- `onNavigate(screenNumber)` - NavegaciÃ³n

**Flujo interno**:
1. Al montar, inicia anÃ¡lisis automÃ¡ticamente
2. Llama a `moderateImage(imageKey)` del apiService
3. Actualiza visual de cada paso
4. Al completar, llama `onAnalysisComplete(result)`
5. App.jsx redirige a Screen 3, 4 o 7

---

#### Screen 3: Contenido Seguro

**Archivo**: `screens/Screen3/Screen3.jsx`

**PropÃ³sito**: Mostrar resultado positivo (imagen segura).

**CaracterÃ­sticas**:
- Icono de escudo verde
- Vista previa de imagen analizada
- Barras de progreso con categorÃ­as detectadas
- BotÃ³n "Aprobar y Publicar"
- Mensaje de Ã©xito

**Props recibidos**:
- `moderationResult` - Resultado del anÃ¡lisis
- `imageUrl` - URL de la imagen analizada
- `onReset()` - Volver a Screen 1

---

#### Screen 4: Contenido Inseguro

**Archivo**: `screens/Screen4/Screen4.jsx`

**PropÃ³sito**: Mostrar resultado negativo (contenido peligroso).

**CaracterÃ­sticas**:
- Imagen difuminada con overlay
- Icono X rojo en cÃ­rculo
- Advertencia de contenido sensible
- Barras de detecciÃ³n con niveles
- BotÃ³n "Revelar (Solo Admin)"
- Botones: Rechazar / Solicitar RevisiÃ³n

**Props recibidos**:
- `moderationResult` - Resultado del anÃ¡lisis
- `imageUrl` - URL de la imagen
- `onReset()` - Volver a Screen 1

---

#### Screen 5: Historial

**Archivo**: `screens/Screen5/Screen5.jsx`

**PropÃ³sito**: Ver anÃ¡lisis previos guardados.

**CaracterÃ­sticas**:
- Filtros por estado: Todos / Seguros / Sugestivos / Inseguros
- Grilla responsive (4 â†’ 3 â†’ 2 â†’ 1 columnas)
- Cards con borde de color segÃºn estado
- EstadÃ­sticas globales (total, seguros, sugestivos, inseguros)
- Datos persistidos en localStorage

**Funcionamiento**:
1. Lee datos de `localStorage.factum_history`
2. Aplica filtros segÃºn selecciÃ³n
3. Muestra tarjetas con `HistoryCard`
4. Permite limpiar historial

---

#### Screen 6: ConfiguraciÃ³n

**Archivo**: `screens/Screen6/Screen6.jsx`

**PropÃ³sito**: Ajustar parÃ¡metros de moderaciÃ³n.

**CaracterÃ­sticas**:
- Slider para threshold (0-100%)
- Toggles para tipos de detecciÃ³n:
  - Detectar Desnudez ExplÃ­cita (on/off)
  - Detectar Contenido Sugestivo (on/off)
- BotÃ³n "Guardar ConfiguraciÃ³n"
- Mensaje de confirmaciÃ³n
- Datos persistidos en localStorage

---

#### Screen 7 (ScreenSuggestive): Contenido Sugestivo

**Archivo**: `screens/ScreenSuggestive/ScreenSuggestive.jsx`

**PropÃ³sito**: Mostrar contenido que requiere revisiÃ³n manual.

**CaracterÃ­sticas**:
- Icono de advertencia amarillo
- Imagen visible (no bloqueada)
- Mensaje explicativo del nivel de riesgo
- Botones: Aprobar / Rechazar / Revisar
- Barras con etiquetas detectadas

---

### 5.3 Componentes Reutilizables

#### Navigation

**Archivo**: `components/Navigation/Navigation.jsx`

Barra de navegaciÃ³n superior.

```jsx
<Navigation 
  currentScreen={1}           // Pantalla actual resaltada
  onNavigate={(num) => {...}} // FunciÃ³n para cambiar pantalla
/>
```

**Botones**: Upload | Procesando | Seguro | Inseguro | Historial | Config

---

#### ProgressSteps

**Archivo**: `components/ProgressSteps/ProgressSteps.jsx`

Indicador de pasos con iconos y estados.

```jsx
<ProgressSteps steps={[
  { id: 's3', title: '1. Subiendo a S3...', status: 'completed' },
  { id: 'lambda', title: '2. Invocando Lambda...', status: 'loading' },
  { id: 'rekognition', title: '3. Consultando Rekognition...', status: 'pending' }
]} />
```

**Estados posibles**: `pending` | `loading` | `completed` | `error`

---

#### ProgressBar

**Archivo**: `components/ProgressBar/ProgressBar.jsx`

Barra de progreso horizontal.

```jsx
<ProgressBar 
  label="Desnudez"    // Nombre de la categorÃ­a
  value={0.85}        // Valor de 0 a 1
  color="#ef4444"     // Color de la barra
/>
```

---

#### ImagePreview

**Archivo**: `components/ImagePreview/ImagePreview.jsx`

Vista previa de imagen con soporte para blur.

```jsx
<ImagePreview 
  imageUrl="https://..."   // URL de la imagen
  blurred={true}           // Aplicar difuminado
  showRevealBtn={true}     // Mostrar botÃ³n revelar
  onReveal={() => {...}}   // Callback al revelar
/>
```

---

#### HistoryCard

**Archivo**: `components/HistoryCard/HistoryCard.jsx`

Tarjeta individual para el historial.

```jsx
<HistoryCard item={{
  status: 'safe',           // 'safe' | 'suggestive' | 'unsafe'
  imageName: 'foto.jpg',
  date: '2025-01-26',
  confidence: 95.5,
  labels: [...]
}} />
```

---

## 6. Backend - AWS Lambda

### 6.1 Lambda: get-presigned-url

**UbicaciÃ³n**: `lambda/get-presigned-url/index.js`

**PropÃ³sito**: Generar una URL firmada temporal para subir imÃ¡genes a S3.

#### Entrada (Request Body)

```json
{
  "fileName": "imagen.jpg",
  "fileType": "image/jpeg"
}
```

#### Salida (Response)

```json
{
  "uploadUrl": "https://bucket.s3.amazonaws.com/uploads/...",
  "imageKey": "uploads/1706300000000-imagen.jpg",
  "expiresIn": 300
}
```

#### LÃ³gica Interna

1. Recibe nombre y tipo de archivo
2. Valida que sea una imagen (`fileType.startsWith('image/')`)
3. Genera key Ãºnico: `uploads/{timestamp}-{fileName}`
4. Crea URL prefirmada con expiraciÃ³n de 5 minutos
5. Retorna URL y key

#### Variables de Entorno Requeridas

| Variable | DescripciÃ³n |
|----------|-------------|
| `S3_BUCKET_NAME` | Nombre del bucket S3 |
| `AWS_REGION` | RegiÃ³n de AWS (ej: us-east-2) |

#### Dependencias

```json
{
  "@aws-sdk/client-s3": "^3.x",
  "@aws-sdk/s3-request-presigner": "^3.x"
}
```

---

### 6.2 Lambda: moderate-image

**UbicaciÃ³n**: `lambda/moderate-image/index.js`

**PropÃ³sito**: Analizar una imagen con Amazon Rekognition.

#### Entrada (Request Body)

```json
{
  "imageKey": "uploads/1706300000000-imagen.jpg"
}
```

#### Salida (Response)

```json
{
  "isInappropriate": true,
  "confidence": 95.5,
  "labels": [
    {
      "Name": "Explicit Nudity",
      "Confidence": 95.5,
      "ParentName": "Nudity"
    }
  ],
  "message": "Se detectÃ³ contenido inapropiado...",
  "threshold": 70
}
```

#### LÃ³gica Interna

1. Recibe key de imagen en S3
2. Llama a `detectModerationLabels()` de Rekognition
3. Analiza etiquetas detectadas
4. Determina si es inapropiado basÃ¡ndose en:
   - CategorÃ­as: `Explicit Nudity`, `Violence`, etc.
   - Umbral de confianza: 70%
5. Retorna resultado estructurado

#### CategorÃ­as ExplÃ­citas (Bloqueo AutomÃ¡tico)

```javascript
const explicitCategories = [
  'Explicit Nudity',
  'Nudity',
  'Graphic Male Nudity',
  'Graphic Female Nudity',
  'Sexual Activity',
  'Illustrated Explicit Nudity',
  'Adult Toys'
];
```

#### Variables de Entorno Requeridas

| Variable | DescripciÃ³n |
|----------|-------------|
| `S3_BUCKET_NAME` | Nombre del bucket S3 |
| `AWS_REGION` | RegiÃ³n de AWS |

#### Dependencias

```json
{
  "@aws-sdk/client-rekognition": "^3.x"
}
```

---

## 7. Flujo de Datos Completo

### Paso a Paso Detallado

```
PASO 1: USUARIO SUBE IMAGEN
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Usuario â†’ Screen1.jsx
  â”‚
  â”œâ”€ Arrastra imagen al Ã¡rea de drop
  â”œâ”€ react-dropzone detecta el archivo
  â”œâ”€ Valida: tipo (image/*) y tamaÃ±o (< 10MB)
  â””â”€ Crea preview local con FileReader

PASO 2: OBTENER URL PREFIRMADA
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Screen1.jsx â†’ apiService.getPresignedUrl()
  â”‚
  â”œâ”€ POST a: {API_GATEWAY}/presigned-url
  â”‚   Body: { fileName: "foto.jpg", fileType: "image/jpeg" }
  â”‚
  â–¼
API Gateway â†’ Lambda: get-presigned-url
  â”‚
  â”œâ”€ Genera key: "uploads/1706300000000-foto.jpg"
  â”œâ”€ Crea URL prefirmada (vÃ¡lida 5 minutos)
  â””â”€ Retorna: { uploadUrl, imageKey, expiresIn }

PASO 3: SUBIR IMAGEN A S3
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
apiService.uploadToS3(presignedUrl, file)
  â”‚
  â”œâ”€ PUT directo a S3 usando la URL prefirmada
  â”œâ”€ Headers: Content-Type: image/jpeg
  â””â”€ Imagen guardada en: s3://bucket/uploads/{key}

PASO 4: TRANSICIÃ“N A PROCESAMIENTO
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Screen1.jsx
  â”‚
  â”œâ”€ Llama: onImageSelected({ key, name, url })
  â”œâ”€ App.jsx actualiza: setImageData(data)
  â””â”€ App.jsx navega: setCurrentScreen(2)

PASO 5: ANÃLISIS CON REKOGNITION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Screen2.jsx â†’ apiService.moderateImage(imageKey)
  â”‚
  â”œâ”€ POST a: {API_GATEWAY}/moderate
  â”‚   Body: { imageKey: "uploads/..." }
  â”‚
  â–¼
API Gateway â†’ Lambda: moderate-image
  â”‚
  â”œâ”€ Llama a: rekognition.detectModerationLabels()
  â”‚   ParÃ¡metros: { Image: { S3Object: { Bucket, Name } } }
  â”‚
  â–¼
Amazon Rekognition
  â”‚
  â”œâ”€ Analiza contenido de la imagen
  â”œâ”€ Detecta etiquetas de moderaciÃ³n
  â””â”€ Retorna: [ { Name, Confidence, ParentName }, ... ]

PASO 6: PROCESAMIENTO DE RESULTADO
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Lambda: moderate-image
  â”‚
  â”œâ”€ EvalÃºa etiquetas vs categorÃ­as explÃ­citas
  â”œâ”€ Calcula: isInappropriate = true/false
  â”œâ”€ Prepara mensaje en espaÃ±ol
  â””â”€ Retorna: { isInappropriate, labels, confidence, message }

PASO 7: CLASIFICACIÃ“N Y REDIRECCIÃ“N
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
App.jsx â†’ handleAnalysisComplete(result)
  â”‚
  â”œâ”€ Llama: detectContentStatus(result)
  â”‚   â””â”€ EvalÃºa labels contra taxonomÃ­a
  â”‚   â””â”€ Retorna: 'safe' | 'suggestive' | 'unsafe'
  â”‚
  â”œâ”€ Enriquece resultado: { ...result, status: 'safe' }
  â”œâ”€ Guarda en historial: saveToHistory(imageData, result)
  â”‚
  â””â”€ Navega segÃºn status:
      â”œâ”€ 'safe'       â†’ Screen 3 (Verde)
      â”œâ”€ 'suggestive' â†’ Screen 7 (Amarillo)
      â””â”€ 'unsafe'     â†’ Screen 4 (Rojo)

PASO 8: MOSTRAR RESULTADO
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Screen3/4/7.jsx
  â”‚
  â”œâ”€ Muestra imagen (con/sin blur segÃºn pantalla)
  â”œâ”€ Muestra barras de categorÃ­as detectadas
  â”œâ”€ Muestra mensaje de estado
  â””â”€ Ofrece acciones: Aprobar/Rechazar/Revisar

PASO 9: RESET (OPCIONAL)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Usuario click "Nuevo AnÃ¡lisis"
  â”‚
  â””â”€ onReset() â†’ App.jsx:
      â”œâ”€ setImageData(null)
      â”œâ”€ setModerationResult(null)
      â””â”€ setCurrentScreen(1)
```

---

## 8. Sistema de ClasificaciÃ³n de Contenido

### TaxonomÃ­a Oficial de Amazon Rekognition

#### Nivel 1: INSEGURO (Bloqueo AutomÃ¡tico)

| CategorÃ­a | DescripciÃ³n |
|-----------|-------------|
| `Explicit Nudity` | Desnudez explÃ­cita |
| `Graphic Male Nudity` | Desnudez masculina grÃ¡fica |
| `Graphic Female Nudity` | Desnudez femenina grÃ¡fica |
| `Sexual Activity` | Actividad sexual explÃ­cita |
| `Illustrated Explicit Nudity` | Desnudez explÃ­cita ilustrada |
| `Adult Toys` | Juguetes para adultos |
| `Violence` | Violencia fÃ­sica, armas en uso |
| `Visually Disturbing` | Gore, mutilaciones |
| `Hate Symbols` | SÃ­mbolos de odio, nazis |

#### Nivel 2: SUGESTIVO (RevisiÃ³n Manual)

| CategorÃ­a | DescripciÃ³n |
|-----------|-------------|
| `Suggestive` | Contenido sexualmente sugestivo |
| `Revealing Clothes` | Ropa reveladora |
| `Swimwear or Underwear` | Trajes de baÃ±o, ropa interior |
| `Partial Nudity` | Desnudez parcial |
| `Barechested` | Torso descubierto |
| `Tobacco` | Productos de tabaco |
| `Alcohol` | Bebidas alcohÃ³licas |
| `Drugs` | Sustancias controladas |
| `Gambling` | Contenido de apuestas |

#### Nivel 3: SEGURO

Todo lo que no coincida con las categorÃ­as anteriores.

### LÃ³gica de ClasificaciÃ³n en el Frontend

```javascript
// Orden de prioridad: primero lo mÃ¡s grave
1. Si backend.isInappropriate === true â†’ 'unsafe'
2. Si labels contiene UNSAFE_PARENTS â†’ 'unsafe'
3. Si labels contiene SUGGESTIVE â†’ 'suggestive'
4. Default â†’ 'safe'
```

---

## 9. Servicios y Utilidades

### 9.1 apiService.js

**UbicaciÃ³n**: `src/services/apiService.js`

Maneja toda la comunicaciÃ³n con AWS.

#### Funciones Exportadas

```javascript
// Obtener URL prefirmada para subir a S3
export const getPresignedUrl = async (fileName, fileType) => {
  // POST a /presigned-url
  // Retorna: { uploadUrl, imageKey }
}

// Subir imagen usando URL prefirmada
export const uploadToS3 = async (presignedUrl, file) => {
  // PUT directo a S3
}

// Solicitar anÃ¡lisis de moderaciÃ³n
export const moderateImage = async (imageKey, threshold = 85) => {
  // POST a /moderate
  // Retorna: { isInappropriate, labels, confidence, message }
}
```

---

### 9.2 historyService.js

**UbicaciÃ³n**: `src/services/historyService.js`

Gestiona el historial en localStorage.

#### Funciones Exportadas

```javascript
// Guardar anÃ¡lisis en historial
export const saveToHistory = (imageData, result) => {
  // AÃ±ade al inicio del array
  // LÃ­mite: 100 items mÃ¡ximo
}

// Obtener todo el historial
export const getHistory = () => {
  // Lee de localStorage.factum_history
  // Retorna: array de items
}

// Filtrar historial por estado
export const filterHistory = (status) => {
  // status: 'all' | 'safe' | 'suggestive' | 'unsafe'
}

// Limpiar historial
export const clearHistory = () => {
  // Elimina factum_history de localStorage
}

// Obtener estadÃ­sticas
export const getStats = () => {
  // Retorna: { total, safe, suggestive, unsafe }
}
```

#### Estructura de un Item de Historial

```javascript
{
  id: "uuid-generado",
  imageName: "foto.jpg",
  status: "safe",           // 'safe' | 'suggestive' | 'unsafe'
  confidence: 95.5,
  labels: [...],
  date: "2025-01-26T12:00:00.000Z",
  timestamp: 1706270400000
}
```

---

### 9.3 configService.js

**UbicaciÃ³n**: `src/services/configService.js`

Gestiona la configuraciÃ³n del usuario.

#### ConfiguraciÃ³n por Defecto

```javascript
const DEFAULT_CONFIG = {
  threshold: 85,              // Umbral de confianza (0-100)
  explicitNudity: true,       // Detectar desnudez explÃ­cita
  suggestive: false           // Detectar contenido sugestivo
};
```

#### Funciones Exportadas

```javascript
// Obtener configuraciÃ³n actual
export const getConfig = () => {
  // Lee de localStorage.factum_config
  // Retorna configuraciÃ³n con defaults
}

// Guardar configuraciÃ³n
export const saveConfig = (config) => {
  // Merge con defaults
  // Guarda en localStorage
}

// Resetear a valores por defecto
export const resetConfig = () => {
  // Elimina factum_config
}
```

---

## 10. ConfiguraciÃ³n de Variables de Entorno

### Archivo `.env` en `factum-app/`

```env
# ============================================
# CONFIGURACIÃ“N DE AWS PARA FACTUM AI
# ============================================

# URL de tu API Gateway (SIN barra al final)
# Ejemplo: https://abc123xyz.execute-api.us-east-2.amazonaws.com/prod
VITE_API_GATEWAY_URL=https://tu-api-id.execute-api.us-east-2.amazonaws.com/prod

# RegiÃ³n de AWS donde estÃ¡n tus servicios
# Opciones comunes: us-east-1, us-east-2, us-west-2, eu-west-1
VITE_AWS_REGION=us-east-2

# Nombre de tu bucket S3 (debe coincidir con el de Lambda)
VITE_S3_BUCKET_NAME=tu-bucket-name
```

### CÃ³mo Obtener Estos Valores

1. **VITE_API_GATEWAY_URL**:
   - AWS Console â†’ API Gateway â†’ Tu API â†’ Stages â†’ prod
   - Copiar "Invoke URL"

2. **VITE_AWS_REGION**:
   - La regiÃ³n donde creaste tus recursos (ej: us-east-2)

3. **VITE_S3_BUCKET_NAME**:
   - AWS Console â†’ S3 â†’ Nombre de tu bucket

### Variables en Lambda

Cada funciÃ³n Lambda tambiÃ©n necesita variables:

| Lambda | Variable | Valor |
|--------|----------|-------|
| get-presigned-url | `S3_BUCKET_NAME` | tu-bucket-name |
| get-presigned-url | `AWS_REGION` | us-east-2 |
| moderate-image | `S3_BUCKET_NAME` | tu-bucket-name |
| moderate-image | `AWS_REGION` | us-east-2 |

---

## 11. GuÃ­a de Despliegue

### Desarrollo Local

```bash
# 1. Clonar repositorio
git clone https://github.com/T0NY24/Factum-AI.git
cd Factum-AI

# 2. Instalar dependencias del frontend
cd factum-app
npm install

# 3. Configurar .env (ver secciÃ³n anterior)
cp .env.example .env
# Editar .env con tus valores de AWS

# 4. Ejecutar servidor de desarrollo
npm run dev
# Abrir http://localhost:5173
```

### Desplegar Lambdas

```bash
# Lambda 1: get-presigned-url
cd lambda/get-presigned-url
npm install
zip -r function.zip .
# Subir function.zip a AWS Lambda

# Lambda 2: moderate-image
cd ../moderate-image
npm install
zip -r function.zip .
# Subir function.zip a AWS Lambda
```

### Build de ProducciÃ³n

```bash
cd factum-app
npm run build
# Los archivos se generan en dist/
```

### Opciones de Hosting

1. **Vercel** (Actual en producciÃ³n)
2. **AWS Amplify**: ConexiÃ³n directa a GitHub
3. **AWS S3 + CloudFront**: Hosting estÃ¡tico
4. **Netlify**: Alternativa moderna

---

## 12. Despliegue en ProducciÃ³n

### InformaciÃ³n de ProducciÃ³n

**Factum AI** estÃ¡ actualmente desplegado en producciÃ³n y accesible pÃºblicamente:

- ğŸŒ **URL Principal**: [https://factum-ia.com](https://factum-ia.com)
- ğŸš€ **Plataforma de Hosting**: Vercel
- ğŸ“¡ **Dominio**: factum-ia.com (registrado en Namecheap)
- ğŸ”— **API Backend**: AWS API Gateway (us-east-2)

### Arquitectura de Despliegue

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    factum-ia.com                            â”‚
â”‚                 (Dominio en Namecheap)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ DNS apunta a
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        VERCEL                               â”‚
â”‚                  (Hosting Frontend)                         â”‚
â”‚                                                             â”‚
â”‚  â€¢ Build automÃ¡tico desde Git                              â”‚
â”‚  â€¢ CDN global                                               â”‚
â”‚  â€¢ SSL/TLS automÃ¡tico                                       â”‚
â”‚  â€¢ Variables de entorno configuradas                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ API calls
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AWS SERVICIOS                            â”‚
â”‚                   (Region: us-east-2)                       â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚  API Gateway     â”‚  â”‚   Lambda         â”‚               â”‚
â”‚  â”‚  (Prod Stage)    â”‚â”€â”€â”‚   Functions      â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚  S3 Bucket       â”‚  â”‚  Rekognition     â”‚               â”‚
â”‚  â”‚  (Images)        â”‚  â”‚  (AI Analysis)   â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ConfiguraciÃ³n de Vercel

#### Build Settings

```bash
# Framework Preset
Framework: Vite

# Build Command
npm run build

# Output Directory
dist

# Install Command
npm install
```

#### Variables de Entorno en Vercel

En el panel de Vercel â†’ Settings â†’ Environment Variables:

| Variable | Valor | Entorno |
|----------|-------|----------|
| `VITE_API_GATEWAY_URL` | `https://sjrqtfqq3k.execute-api.us-east-2.amazonaws.com/prod` | Production |
| `VITE_AWS_REGION` | `us-east-2` | Production |
| `VITE_S3_BUCKET_NAME` | `factum-content-moderation` | Production |

#### ConfiguraciÃ³n del Dominio en Namecheap

**Dominio**: factum-ia.com

**ConfiguraciÃ³n DNS**:

1. **Tipo A**: Apunta a los IPs de Vercel
2. **Tipo CNAME**: `www` â†’ `cname.vercel-dns.com`

**Pasos de configuraciÃ³n**:

1. En Namecheap:
   - Dashboard â†’ Domain List â†’ factum-ia.com â†’ Manage
   - Advanced DNS â†’ Host Records
   - Agregar registros segÃºn Vercel

2. En Vercel:
   - Project Settings â†’ Domains
   - Add Domain: `factum-ia.com`
   - Add Domain: `www.factum-ia.com`
   - Copiar configuraciÃ³n DNS proporcionada

3. Esperar propagaciÃ³n DNS (puede tomar 24-48 horas)

### Despliegue Continuo

Vercel estÃ¡ configurado con **despliegue automÃ¡tico**:

- âœ… **Push a main** â†’ Deploy automÃ¡tico a producciÃ³n
- âœ… **Pull Request** â†’ Preview deployment automÃ¡tico
- âœ… **Rollback** â†’ Restaurar a versiÃ³n anterior desde dashboard

### Monitoreo y Analytics

**Vercel Analytics** estÃ¡ habilitado para:
- MÃ©tricas de rendimiento (Core Web Vitals)
- Visitantes Ãºnicos
- PÃ¡ginas vistas
- Tiempo de carga

**AWS CloudWatch** monitorea:
- Invocaciones de Lambda
- Errores en las funciones
- Uso de Rekognition
- Transferencias en S3

### URLs de Acceso

| Entorno | URL | PropÃ³sito |
|---------|-----|----------|
| **ProducciÃ³n** | [https://factum-ia.com](https://factum-ia.com) | AplicaciÃ³n principal |
| **ProducciÃ³n (www)** | [https://www.factum-ia.com](https://www.factum-ia.com) | Alias con www |
| **Preview (Vercel)** | `https://factum-app-*.vercel.app` | Despliegues de preview |
| **Local** | `http://localhost:5173` | Desarrollo local |

### Proceso de ActualizaciÃ³n

Para desplegar cambios a producciÃ³n:

```bash
# 1. Desarrollo local
npm run dev
# Hacer cambios y probar localmente

# 2. Commit y push
git add .
git commit -m "feat: descripciÃ³n del cambio"
git push origin main

# 3. Vercel despliega automÃ¡ticamente
# Monitorear en: https://vercel.com/dashboard
```

### ConfiguraciÃ³n de AWS Backend

#### S3 Bucket: `factum-content-moderation`

```json
{
  "RegiÃ³n": "us-east-2",
  "Carpetas": {
    "uploads/": "ImÃ¡genes subidas por usuarios (temporal)"
  },
  "CORS": "Configurado para aceptar requests desde factum-ia.com",
  "Lifecycle": "Eliminar objetos despuÃ©s de 7 dÃ­as"
}
```

#### API Gateway

```
URL Base: https://sjrqtfqq3k.execute-api.us-east-2.amazonaws.com/prod

Endpoints:
  POST /presigned-url  â†’ Lambda: get-presigned-url
  POST /moderate       â†’ Lambda: moderate-image

CORS: Habilitado
AutenticaciÃ³n: API Key (opcional)
```

#### Lambda Functions

**FunciÃ³n 1: get-presigned-url**
- Runtime: Node.js 18.x
- Memoria: 256 MB
- Timeout: 10 segundos
- Rol IAM: Permisos S3:PutObject

**FunciÃ³n 2: moderate-image**
- Runtime: Node.js 18.x
- Memoria: 512 MB
- Timeout: 30 segundos
- Rol IAM: Permisos S3:GetObject, Rekognition:DetectModerationLabels

---

## 13. SoluciÃ³n de Problemas

### Error: CORS en API Gateway

**SÃ­ntoma**: Error "Access to fetch at ... has been blocked by CORS policy"

**SoluciÃ³n**:
1. API Gateway â†’ Recurso â†’ Enable CORS
2. Marcar: POST, OPTIONS
3. Redesplegar la API

---

### Error: URL Prefirmada Expirada

**SÃ­ntoma**: Error al subir imagen despuÃ©s de esperar

**Causa**: Las URLs expiran en 5 minutos

**SoluciÃ³n**: Reintentar subida (genera nueva URL automÃ¡ticamente)

---

### Error: Access Denied en S3

**SÃ­ntoma**: 403 Forbidden al subir imagen

**SoluciÃ³n**:
1. Verificar permisos IAM del rol de Lambda
2. Verificar configuraciÃ³n CORS del bucket S3
3. Confirmar que el bucket existe

---

### Error: Rekognition No Detecta Nada

**SÃ­ntoma**: Resultado siempre vacÃ­o

**Posibles causas**:
1. Imagen no se subiÃ³ correctamente a S3
2. Permisos de Lambda para leer S3
3. MinConfidence muy alto

**SoluciÃ³n**: Revisar CloudWatch Logs de la Lambda

---

### Las Screens 3/4/7 Aparecen VacÃ­as

**SÃ­ntoma**: Pantallas de resultado sin datos

**Causa**: Se accediÃ³ directamente sin pasar por el flujo

**SoluciÃ³n**: Iniciar desde Screen 1 (Upload)

---

## ğŸ“ Notas Finales

### Lo que SÃ hace este proyecto

- âœ… Moderar imÃ¡genes estÃ¡ticas (JPG, PNG, GIF, WEBP)
- âœ… Clasificar en 3 niveles de riesgo
- âœ… Guardar historial localmente
- âœ… Configurar umbrales de detecciÃ³n

### Lo que NO hace este proyecto

- âŒ AutenticaciÃ³n de usuarios
- âŒ Base de datos persistente (solo localStorage)
- âŒ ModeraciÃ³n de videos
- âŒ ModeraciÃ³n de texto
- âŒ Tests automatizados

### Mejoras Futuras Sugeridas

1. **AutenticaciÃ³n**: AWS Cognito
2. **Base de datos**: DynamoDB para historial persistente
3. **Video**: Soporte para moderaciÃ³n de video
4. **Tests**: Jest + React Testing Library
5. **CI/CD**: GitHub Actions + AWS Amplify

---

**Ãšltima actualizaciÃ³n**: 2026-02-05  
**VersiÃ³n**: 4.0.0  
**Estado**: En producciÃ³n en https://factum-ia.com  
**Hosting**: Vercel + AWS (us-east-2)
